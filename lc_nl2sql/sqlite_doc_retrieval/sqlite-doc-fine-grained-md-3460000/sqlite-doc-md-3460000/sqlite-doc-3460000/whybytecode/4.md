## 1\.3\. Definition Of "Abstract Syntax Tree" or "AST"



An "[Abstract Syntax Tree](https://en.wikipedia.org/wiki/Abstract_syntax_tree)" or AST
is a data structure that describes a program or statement in some kind of formal
language. In our context, the formal language is SQL. An AST is typically
implemented as a tree of objects where each object represents one small part of
the overall SQL statement. ASTs emerge naturally from parsers for formal languages.
The usual technique is to use an 
[LALR(1\) parser](https://en.wikipedia.org/wiki/LALR_parser).
With such a parser, each terminal
symbol holds metadata that will become a leaf of the AST, and each non\-terminal 
symbol holds metadata that will become a sub\-branch of the overall AST.
As rules of the grammar are "reduced" by the parser, new nodes of the AST are
allocated and connected to subnodes.
After the parse completes, the start\-symbol of the grammar is left holding the
root of the AST.



An AST is a tree of objects. But an AST is not a suitable form for
a prepared statement. After being generated, an AST first needs to be
transformed in various ways before it can executed. Symbols need to be
resolved. Semantic rules need to be checked. Optimizations need to be
applied that transform input SQL statement into different forms that
execute more quickly. Finally, the AST needs to be translated into an
alternative representation that is more amenable to execution.



Some people refer to the tree of objects that is used as the
executable form for MySQL and PostgreSQL as an AST. This is probably a
misuse of the term "AST", because by the time the tree of objects is
ready to be executed, it has been changed so much that it has little
resemblance to the original SQL text. The confusion arises in part because
both the final prepared statement object and the original AST are both
trees of objects. The usual technique is for the original AST that comes
directly out of the parser to be transformed little by little, in multiple
passes, until at the end it is fully converted into an tree of objects
that is no longer strictly an AST but that can be evaluated to
generate a result. There is not necessarily a clear point during this
process when the tree\-of\-objects ceases to be an AST and becomes a
prepared statement instead. And because there is no clear boundary between an
AST and a prepared statement, people often refer to a prepared statement
that is represented as a tree of objects as an "AST", even though that
description is not precise.



