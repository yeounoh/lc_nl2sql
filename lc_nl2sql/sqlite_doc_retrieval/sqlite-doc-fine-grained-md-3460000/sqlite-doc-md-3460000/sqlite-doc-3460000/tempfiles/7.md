## 2\.5\. Statement Journal Files



A statement journal file is used to rollback partial results of
a single statement within a larger transaction. For example, suppose
an UPDATE statement will attempt to modify 100 rows in the database.
But after modifying the first 50 rows, the UPDATE hits
a constraint violation which should block the entire statement.
The statement journal is used to undo the first 50 row changes
so that the database is restored to the state it was in at the start
of the statement.




A statement journal is only created for an UPDATE or INSERT statement
that might change multiple rows of a database and which might hit a
constraint or a RAISE exception within a trigger and thus need to
undo partial results.
If the UPDATE or INSERT is not contained within BEGIN...COMMIT and if
there are no other active statements on the same database connection then
no statement journal is created since the ordinary
rollback journal can be used instead.
The statement journal is also omitted if an alternative
[conflict resolution algorithm](lang_conflict.html) is
used. For example:




> ```
> 
> UPDATE OR FAIL ...
> UPDATE OR IGNORE ...
> UPDATE OR REPLACE ...
> UPDATE OR ROLLBACK ...
> INSERT OR FAIL ...
> INSERT OR IGNORE ...
> INSERT OR REPLACE ...
> INSERT OR ROLLBACK ...
> REPLACE INTO ....
> 
> ```



The statement journal is given a randomized name, not necessarily
in the same directory as the main database, and is automatically
deleted at the conclusion of the transaction. The size of the
statement journal is proportional to the size of the change implemented
by the UPDATE or INSERT statement that caused the statement journal
to be created.




