## 2\.8\. Transient Indices



SQLite may make use of transient indices to
implement SQL language features such as:



* An ORDER BY or GROUP BY clause
* The DISTINCT keyword in an aggregate query
* Compound SELECT statements joined by UNION, EXCEPT, or INTERSECT



Each transient index is stored in its own temporary file.
The temporary file for a transient index is automatically deleted
at the end of the statement that uses it.




SQLite strives to implement ORDER BY clauses using a preexisting
index. If an appropriate index already exists, SQLite will walk
the index, rather than the underlying table, to extract the 
requested information, and thus cause the rows to come out in
the desired order. But if SQLite cannot find an appropriate index
it will evaluate the query and store each row in a transient index
whose data is the row data and whose key is the ORDER BY terms.
After the query is evaluated, SQLite goes back and walks the
transient index from beginning to end in order to output the
rows in the desired order.




SQLite implements GROUP BY by ordering the output rows in the
order suggested by the GROUP BY terms. Each output row is
compared to the previous to see if it starts a new "group".
The ordering by GROUP BY terms is done in exactly the same way
as the ordering by ORDER BY terms. A preexisting index is used
if possible, but if no suitable index is available, a transient
index is created.




The DISTINCT keyword on an aggregate query is implemented by
creating a transient index in a temporary file and storing
each result row in that index. As new result rows are computed
a check is made to see if they already exist in the transient
index and if they do the new result row is discarded.




The UNION operator for compound queries is implemented by creating
a transient index in a temporary file and storing the results
of the left and right subquery in the transient index, discarding
duplicates. After both subqueries have been evaluated, the
transient index is walked from beginning to end to generate the final output.




The EXCEPT operator for compound queries is implemented by creating
a transient index in a temporary file, storing the results of the
left subquery in this transient index, then removing the result 
from right subquery from the transient index, and finally walking
the index from beginning to end to obtain the final output.




The INTERSECT operator for compound queries is implemented by
creating two separate transient indices, each in a separate
temporary file. The left and right subqueries are evaluated
each into a separate transient index. Then the two indices
are walked together and entries that appear in both indices
are output.




Note that the UNION ALL operator for compound queries does not
use transient indices by itself (though of course the right
and left subqueries of the UNION ALL might use transient indices
depending on how they are composed.)




