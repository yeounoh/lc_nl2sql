## 2\.1\. Rollback Journals



A rollback journal is a temporary file used to implement
atomic commit and rollback capabilities in SQLite.
(For a detailed discussion of how this works, see
the separate document titled
[Atomic Commit In SQLite](atomiccommit.html).)
The rollback journal is always located in the same directory
as the database file and has the same name as the database
file except with the 8 characters "**\-journal**" appended.
The rollback journal is usually created when a transaction
is first started and is usually deleted when a transaction
commits or rolls back.
The rollback journal file is essential for implementing the
atomic commit and rollback capabilities of SQLite. Without
a rollback journal, SQLite would be unable to rollback an
incomplete transaction, and if a crash or power loss occurred
in the middle of a transaction the entire database would likely
go corrupt without a rollback journal.




The rollback journal is *usually* created and destroyed at the
start and end of a transaction, respectively. But there are exceptions
to this rule.




If a crash or power loss occurs in the middle of a transaction,
then the rollback journal file is left on disk. The next time
another application attempts to open the database file, it notices
the presence of the abandoned rollback journal (we call it a "hot
journal" in this circumstance) and uses the information in the
journal to restore the database to its state prior to the start
of the incomplete transaction. This is how SQLite implements
atomic commit.




If an application puts SQLite in 
[exclusive locking mode](pragma.html#pragma_locking_mode) using
the pragma:




> ```
> 
> PRAGMA locking_mode=EXCLUSIVE;
> 
> ```



SQLite creates a new rollback journal at the start of the first
transaction within an exclusive locking mode session. But at the
conclusion of the transaction, it does not delete the rollback
journal. The rollback journal might be truncated, or its header
might be zeroed (depending on what version of SQLite you are using)
but the rollback journal is not deleted. The rollback journal is
not deleted until exclusive access mode is exited.



Rollback journal creation and deletion is also changed by the
[journal\_mode pragma](pragma.html#pragma_journal_mode).
The default journaling mode is DELETE, which is the default behavior
of deleting the rollback journal file at the end of each transaction,
as described above. The PERSIST journal mode foregoes the deletion of
the journal file and instead overwrites the rollback journal header
with zeros, which prevents other processes from rolling back the
journal and thus has the same effect as deleting the journal file, though
without the expense of actually removing the file from disk. In other
words, journal mode PERSIST exhibits the same behavior as is seen
in EXCLUSIVE locking mode. The
OFF journal mode causes SQLite to omit the rollback journal, completely.
In other words, no rollback journal is ever written if journal mode is
set to OFF.
The OFF journal mode disables the atomic
commit and rollback capabilities of SQLite. The ROLLBACK command
is not available when OFF journal mode is set. And if a crash or power
loss occurs in the middle of a transaction that uses the OFF journal
mode, no recovery is possible and the database file will likely
go corrupt.
The MEMORY journal mode causes the rollback journal to be stored in
memory rather than on disk. The ROLLBACK command still works when
the journal mode is MEMORY, but because no file exists on disks for
recovery, a crash or power loss in the middle of a transaction that uses
the MEMORY journal mode will likely result in a corrupt database.




