## Start a read transaction on an historical snapshot




> ```
> 
> int sqlite3_snapshot_open(
>   sqlite3 *db,
>   const char *zSchema,
>   sqlite3_snapshot *pSnapshot
> );
> 
> ```



The [sqlite3\_snapshot\_open(D,S,P)](../c3ref/snapshot_open.html) interface either starts a new read
transaction or upgrades an existing one for schema S of
[database connection](../c3ref/sqlite3.html) D such that the read transaction refers to
historical [snapshot](../c3ref/snapshot.html) P, rather than the most recent change to the
database. The [sqlite3\_snapshot\_open()](../c3ref/snapshot_open.html) interface returns SQLITE\_OK
on success or an appropriate [error code](../rescode.html) if it fails.


In order to succeed, the database connection must not be in
[autocommit mode](../c3ref/get_autocommit.html) when [sqlite3\_snapshot\_open(D,S,P)](../c3ref/snapshot_open.html) is called. If there
is already a read transaction open on schema S, then the database handle
must have no active statements (SELECT statements that have been passed
to sqlite3\_step() but not sqlite3\_reset() or sqlite3\_finalize()).
SQLITE\_ERROR is returned if either of these conditions is violated, or
if schema S does not exist, or if the snapshot object is invalid.


A call to sqlite3\_snapshot\_open() will fail to open if the specified
snapshot has been overwritten by a [checkpoint](../wal.html#ckpt). In this case
SQLITE\_ERROR\_SNAPSHOT is returned.


If there is already a read transaction open when this function is
invoked, then the same read transaction remains open (on the same
database snapshot) if SQLITE\_ERROR, SQLITE\_BUSY or SQLITE\_ERROR\_SNAPSHOT
is returned. If another error code \- for example SQLITE\_PROTOCOL or an
SQLITE\_IOERR error code \- is returned, then the final state of the
read transaction is undefined. If SQLITE\_OK is returned, then the
read transaction is now open on database snapshot P.


A call to [sqlite3\_snapshot\_open(D,S,P)](../c3ref/snapshot_open.html) will fail if the
database connection D does not know that the database file for
schema S is in [WAL mode](../wal.html). A database connection might not know
that the database file is in [WAL mode](../wal.html) if there has been no prior
I/O on that database connection, or if the database entered [WAL mode](../wal.html)
after the most recent I/O on the database connection.
(Hint: Run "[PRAGMA application\_id](../pragma.html#pragma_application_id)" against a newly opened
database connection in order to make it ready to use snapshots.)


The [sqlite3\_snapshot\_open()](../c3ref/snapshot_open.html) interface is only available when the
[SQLITE\_ENABLE\_SNAPSHOT](../compile.html#enable_snapshot) compile\-time option is used.


See also lists of
 [Objects](../c3ref/objlist.html),
 [Constants](../c3ref/constlist.html), and
 [Functions](../c3ref/funclist.html).


