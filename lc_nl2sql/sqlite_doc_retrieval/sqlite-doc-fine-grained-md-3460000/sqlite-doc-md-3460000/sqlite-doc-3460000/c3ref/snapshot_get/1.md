## Record A Database Snapshot




> ```
> 
> int sqlite3_snapshot_get(
>   sqlite3 *db,
>   const char *zSchema,
>   sqlite3_snapshot **ppSnapshot
> );
> 
> ```



The [sqlite3\_snapshot\_get(D,S,P)](../c3ref/snapshot_get.html) interface attempts to make a
new [sqlite3\_snapshot](../c3ref/snapshot.html) object that records the current state of
schema S in database connection D. On success, the
[sqlite3\_snapshot\_get(D,S,P)](../c3ref/snapshot_get.html) interface writes a pointer to the newly
created [sqlite3\_snapshot](../c3ref/snapshot.html) object into \*P and returns SQLITE\_OK.
If there is not already a read\-transaction open on schema S when
this function is called, one is opened automatically.


The following must be true for this function to succeed. If any of
the following statements are false when sqlite3\_snapshot\_get() is
called, SQLITE\_ERROR is returned. The final value of \*P is undefined
in this case.


* The database handle must not be in [autocommit mode](../c3ref/get_autocommit.html).



- Schema S of [database connection](../c3ref/sqlite3.html) D must be a [WAL mode](../wal.html) database.



- There must not be a write transaction open on schema S of database
connection D.



- One or more transactions must have been written to the current wal
file since it was created on disk (by any connection). This means
that a snapshot cannot be taken on a wal mode database with no wal
file immediately after it is first opened. At least one transaction
must be written to it first.



This function may also return SQLITE\_NOMEM. If it is called with the
database handle in autocommit mode but fails for some other reason,
whether or not a read transaction is opened on schema S is undefined.


The [sqlite3\_snapshot](../c3ref/snapshot.html) object returned from a successful call to
[sqlite3\_snapshot\_get()](../c3ref/snapshot_get.html) must be freed using [sqlite3\_snapshot\_free()](../c3ref/snapshot_free.html)
to avoid a memory leak.


The [sqlite3\_snapshot\_get()](../c3ref/snapshot_get.html) interface is only available when the
[SQLITE\_ENABLE\_SNAPSHOT](../compile.html#enable_snapshot) compile\-time option is used.


See also lists of
 [Objects](../c3ref/objlist.html),
 [Constants](../c3ref/constlist.html), and
 [Functions](../c3ref/funclist.html).


