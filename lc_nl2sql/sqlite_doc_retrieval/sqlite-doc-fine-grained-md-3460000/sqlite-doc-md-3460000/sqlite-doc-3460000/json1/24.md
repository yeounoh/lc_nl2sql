## 4\.10\. The json\_insert(), json\_replace, and json\_set() functions


The json\_insert(), json\_replace, and json\_set() functions all take
a single JSON value as their first argument followed by zero or more
pairs of path and value arguments, and return a new JSON string formed
by updating the input JSON by the path/value pairs. The functions
differ only in how they deal with creating new values and overwriting
preexisting values.






| Function | Overwrite if already exists? | Create if does not exist? |
| --- | --- | --- |
| json\_insert() | No | Yes |
| json\_replace() | Yes | No |
| json\_set() | Yes | Yes |


The json\_insert(), json\_replace(), and json\_set() functions always
take an odd number of arguments. The first argument is always the original
JSON to be edited. Subsequent arguments occur in pairs with the first
element of each pair being a path and the second element being the value
to insert or replace or set on that path.



Edits occur sequentially from left to right. Changes caused by
prior edits can affect the path search for subsequent edits.



If the value of a path/value pair is an SQLite TEXT value, then it
is normally inserted as a quoted JSON string, even if the string looks
like valid JSON. However, if the value is the result of another
json function (such as [json()](json1.html#jmini) or [json\_array()](json1.html#jarray) or [json\_object()](json1.html#jobj))
or if it is the result of [the \-\> operator](json1.html#jptr),
then it is interpreted as JSON and is inserted as JSON retaining all
of its substructure. Values that are the result of [the \-\>\> operator](json1.html#jptr)
are always interpreted as TEXT and are inserted as a JSON string even
if they look like valid JSON.



These routines throw an error if the first JSON argument is not
well\-formed or if any PATH argument is not well\-formed or if any
argument is a BLOB.



To append an element onto the end of an array, using json\_insert()
with an array index of "\#". Examples:

* json\_insert('\[1,2,3,4]','$\[\#]',99\)
→ '\[1,2,3,4,99]'
* json\_insert('\[1,\[2,3],4]','$\[1]\[\#]',99\)
→ '\[1,\[2,3,99],4]'




Other examples:

* json\_insert('{"a":2,"c":4}', '$.a', 99\)
→ '{"a":2,"c":4}'
* json\_insert('{"a":2,"c":4}', '$.e', 99\)
→ '{"a":2,"c":4,"e":99}'
* json\_replace('{"a":2,"c":4}', '$.a', 99\)
→ '{"a":99,"c":4}'
* json\_replace('{"a":2,"c":4}', '$.e', 99\)
→ '{"a":2,"c":4}'
* json\_set('{"a":2,"c":4}', '$.a', 99\)
→ '{"a":99,"c":4}'
* json\_set('{"a":2,"c":4}', '$.e', 99\)
→ '{"a":2,"c":4,"e":99}'
* json\_set('{"a":2,"c":4}', '$.c', '\[97,96]')
→ '{"a":2,"c":"\[97,96]"}'
* json\_set('{"a":2,"c":4}', '$.c', json('\[97,96]'))
→ '{"a":2,"c":\[97,96]}'
* json\_set('{"a":2,"c":4}', '$.c', json\_array(97,96\))
→ '{"a":2,"c":\[97,96]}'







