### 4\.23\.1\. Examples using json\_each() and json\_tree()


Suppose the table "CREATE TABLE user(name,phone)" stores zero or
more phone numbers as a JSON array object in the user.phone field.
To find all users who have any phone number with a 704 area code:




> ```
> 
> SELECT DISTINCT user.name
>   FROM user, json_each(user.phone)
>  WHERE json_each.value LIKE '704-%';
> 
> ```


Now suppose the user.phone field contains plain text if the user
has only a single phone number and a JSON array if the user has multiple
phone numbers. The same question is posed: "Which users have a phone number
in the 704 area code?" But now the json\_each() function can only be called
for those users that have two or more phone numbers since json\_each()
requires well\-formed JSON as its first argument:




> ```
> 
> SELECT name FROM user WHERE phone LIKE '704-%'
> UNION
> SELECT user.name
>   FROM user, json_each(user.phone)
>  WHERE json_valid(user.phone)
>    AND json_each.value LIKE '704-%';
> 
> ```


Consider a different database with "CREATE TABLE big(json JSON)".
To see a complete line\-by\-line decomposition of the data:




> ```
> 
> SELECT big.rowid, fullkey, value
>   FROM big, json_tree(big.json)
>  WHERE json_tree.type NOT IN ('object','array');
> 
> ```


In the previous, the "type NOT IN ('object','array')" term of the
WHERE clause suppresses containers and only lets through leaf elements.
The same effect could be achieved this way:




> ```
> 
> SELECT big.rowid, fullkey, atom
>   FROM big, json_tree(big.json)
>  WHERE atom IS NOT NULL;
> 
> ```


Suppose each entry in the BIG table is a JSON object 
with a '$.id' field that is a unique identifier
and a '$.partlist' field that can be a deeply nested object.
You want to find the id of every entry that contains one
or more references to uuid '6fa5181e\-5721\-11e5\-a04e\-57f3d7b32808' anywhere
in its '$.partlist'.




> ```
> 
> SELECT DISTINCT json_extract(big.json,'$.id')
>   FROM big, json_tree(big.json, '$.partlist')
>  WHERE json_tree.key='uuid'
>    AND json_tree.value='6fa5181e-5721-11e5-a04e-57f3d7b32808';
> 
> ```


*This page last modified on [2024\-05\-05 15:23:53](https://sqlite.org/docsrc/honeypot) UTC* 


