#### 9\.2\.4\.4\. Doclist Index Format


The segment index described in the [previous
section](#data_term_index) allows a segment b\-tree to be efficiently queried by term or,
assuming there is a prefix index of the required size, a term prefix. The data
structure described in this section, doclist indexes, allows FTS5 to
efficiently search for a rowid or range or rowids within the doclist associated
with a single term or term prefix.



Not all keys have associated doclists indexes. By default, a doclist index
is only added for a key if its doclist spans more than 4 segment b\-tree leaf
pages. Doclist indexes are themselves b\-trees, with both leaves and internal
nodes stored as entries in the %\_data table, but in practice most doclists are
small enough to fit on a single leaf. FTS5 uses the same rough size for doclist
index node and leaves as it does for segment b\-tree leaves (by default 4000
bytes).



Doclist index leaves and internal nodes use the same page format. The first
byte is a "flags" byte. This is set to 0x00 for the root page of the doclist
index b\-tree, and 0x01 for all other pages. The remainder of the page is a
series of tightly packed varints, as follows:



* page number of leftmost child page, followed by
* the smallest rowid value on the left most child page, followed by
* one varint for each subsequent child page, containing the value:
	+ 0x00 if there are no rowids on the child page (this can only happen
	 when the "child" page is actually a segment b\-tree leaf), or
	+ the difference between the smallest rowid on the child page and
	 the previous rowid value stored on the doclist index page.


For the leftmost doclist index leaf in a doclist index, the leftmost child
page is the first segment b\-tree leaf after the one that contains the key
itself.



