## 6\.8\. The 'optimize' Command


This command merges all individual b\-trees that currently make up the
full\-text index into a single large b\-tree structure. This ensures that the
full\-text index consumes the minimum space within the database and is in the
fastest form to query.



Refer to the documentation for the [FTS5 automerge option](fts5.html#the_automerge_configuration_option) for more details
regarding the relationship between the full\-text index and its component
b\-trees.




```
INSERT INTO ft(ft) VALUES('optimize');

```

Because it reorganizes the entire FTS index, the optimize command can
take a long time to run. The [FTS5 merge command](fts5.html#the_merge_command) can be used to divide
the work of optimizing the FTS index into multiple steps. To do this:



* Invoke the 'merge' command once with the parameter set to \-N, then
* Invoke the 'merge' command zero or more times with the parameter set to N.


where N is the number of pages of data to merge within each invocation of
the merge command. The application should stop invoking merge when the
difference in the value returned by the sqlite3\_total\_changes() function before
and after the merge command drops to below two. The merge commands may be
issued as part of the same or separate transactions, and by the same or
different database clients. Refer to the documentation for the
[merge command](fts5.html#the_merge_command) for further details.




