#### 9\.2\.4\.1\. The Key/Doclist Format


The key/doclist format is a format used to store a series of keys (document
terms or term prefixes prefixed by a single character to indentify the specific
index to which they belong) in sorted order, each with their associated
doclist. The format consists of alternating keys and doclists packed together.



The first key is stored as:


* A varint indicating the number of bytes in the key (N), followed by
* The key data itself (N bytes).


Each subsequent key is stored as:


* A varint indicating the size of the prefix that the key has in common
 with the previous key in bytes,
* A varint indicating the number of bytes in the key following the
 common prefix (N), followed by
* The key suffix data itself (N bytes).


For example, if the first two keys in an FTS5 key/doclist record are
"0challenger" and "0chandelier", then the first key is stored as varint 11
followed by the 11 bytes "0challenger", and the second key is stored as varints
4 and 7, followed by the 7 bytes "ndelier".







doclist 0




doclist 1
key/doclist 2\...


key 0 data


key 0 size (varint)


key 1 prefix size (varint)


key 1 suffix size (varint)


key 1 prefix data




*Figure 1 \- Term/Doclist Format*


Each doclist identifies the rows (by their rowid values) that contain at
least one instance of the term or term prefix and an associated position list,
or "poslist" enumerating the position of each term instance within the row. In
this sense a "position" is defined as a column number and term offset within
the column value.



Within a doclist, documents are always stored in order sorted by rowid. The
first rowid in a doclist is stored as is, as a varint. It is immediately
followed by its associated position list. Following this, the difference
between the first rowid and the second, as a varint, followed by the doclist
associated with the second rowid in the doclist. And so on.



There is no way to determine the size of a doclist by parsing it. This must
be stored externally. See the [section below](#data_pagination) for
details of how this is accomplished in FTS5\.






position list 0


position list 1

position list 2\...


rowid 0 (varint)


rowid 1 (delta\-encoded varint)


rowid 3 (delta\-encoded varint)




*Figure 2 \- Doclist Format*


A position list \- often shortened to "poslist" \- identifies the column
and token offset within the row of each instance of the token in question.
The format of a poslist is:



* Varint set to twice the size of the poslist, not including this field,
 plus one if the "delete" flag is set on the entry.
* A (possibly empty) list of offsets for column 0 (the leftmost column) of
 the row. Each offset is stored as a varint. The first varint contains
 the value of the first offset, plus 2\. The second variant contains the
 difference between the second and first offsets, plus 2\. etc. For
 example, if the offset list is to contain offsets 0, 10, 15 and 16, it
 is encoded by packing the following values, encoded as varints, end to
 end:
 
```

           2, 12, 7, 3

```
* For each column other than column 0 that contains one of more instances
 of the token:
	+ Byte value 0x01\.
	+ The column number, as a varint.
	+ An offset list, in the same format as the offset list for column 0\.





col 0 offset\-list

0x01


col i offset\-list
nSize\*2 \+ bDel (varint)


column number (i)



nSize bytes


*Figure 3 \- Position List (poslist) With Offsets in Columns 0 and i*


