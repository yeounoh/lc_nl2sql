#define FTS5_TOKEN_COLOCATED    0x0001      /* Same position as prev. token */

```

 The implementation is registered with the FTS5 module by calling the
xCreateTokenizer() method of the fts5\_api object. If there is already a
tokenizer with the same name, it is replaced. If a non\-NULL xDestroy parameter
is passed to xCreateTokenizer(), it is invoked with a copy of the pUserData
pointer passed as the only argument when the database handle is closed or when
the tokenizer is replaced.



 If successful, xCreateTokenizer() returns SQLITE\_OK. Otherwise, it
returns an SQLite error code. In this case the xDestroy function is **not**
invoked.



 When an FTS5 table uses the custom tokenizer, the FTS5 core calls xCreate()
once to create a tokenizer, then xTokenize() zero or more times to tokenize
strings, then xDelete() to free any resources allocated by xCreate(). More
specifically:




**xCreate:**
 This function is used to allocate and initialize a tokenizer instance.
 A tokenizer instance is required to actually tokenize text.



 The first argument passed to this function is a copy of the (void\*)
 pointer provided by the application when the fts5\_tokenizer object
 was registered with FTS5 (the third argument to xCreateTokenizer()). 
 The second and third arguments are an array of nul\-terminated strings
 containing the tokenizer arguments, if any, specified following the
 tokenizer name as part of the CREATE VIRTUAL TABLE statement used
 to create the FTS5 table.



 The final argument is an output variable. If successful, (\*ppOut) 
 should be set to point to the new tokenizer handle and SQLITE\_OK
 returned. If an error occurs, some value other than SQLITE\_OK should
 be returned. In this case, fts5 assumes that the final value of \*ppOut 
 is undefined.





 **xDelete:**
 This function is invoked to delete a tokenizer handle previously
 allocated using xCreate(). Fts5 guarantees that this function will
 be invoked exactly once for each successful call to xCreate().





 **xTokenize:**
 This function is expected to tokenize the nText byte string indicated 
 by argument pText. pText may or may not be nul\-terminated. The first
 argument passed to this function is a pointer to an Fts5Tokenizer object
 returned by an earlier call to xCreate().



 The second argument indicates the reason that FTS5 is requesting
 tokenization of the supplied text. This is always one of the following
 four values:





* **FTS5\_TOKENIZE\_DOCUMENT** \- A document is being inserted into
 or removed from the FTS table. The tokenizer is being invoked to
 determine the set of tokens to add to (or delete from) the
 FTS index.
* **FTS5\_TOKENIZE\_QUERY** \- A MATCH query is being executed 
 against the FTS index. The tokenizer is being called to tokenize 
 a bareword or quoted string specified as part of the query.
* **(FTS5\_TOKENIZE\_QUERY \| FTS5\_TOKENIZE\_PREFIX)** \- Same as
 FTS5\_TOKENIZE\_QUERY, except that the bareword or quoted string is
 followed by a "\*" character, indicating that the last token
 returned by the tokenizer will be treated as a token prefix.
* **FTS5\_TOKENIZE\_AUX** \- The tokenizer is being invoked to 
 satisfy an fts5\_api.xTokenize() request made by an auxiliary
 function. Or an fts5\_api.xColumnSize() request made by the same
 on a columnsize\=0 database.



 For each token in the input string, the supplied callback xToken() must
 be invoked. The first argument to it should be a copy of the pointer
 passed as the second argument to xTokenize(). The third and fourth
 arguments are a pointer to a buffer containing the token text, and the
 size of the token in bytes. The 4th and 5th arguments are the byte offsets
 of the first byte of and first byte immediately following the text from
 which the token is derived within the input.



 The second argument passed to the xToken() callback ("tflags") should
 normally be set to 0\. The exception is if the tokenizer supports 
 synonyms. In this case see the discussion below for details.



 FTS5 assumes the xToken() callback is invoked for each token in the 
 order that they occur within the input text.



 If an xToken() callback returns any value other than SQLITE\_OK, then
 the tokenization should be abandoned and the xTokenize() method should
 immediately return a copy of the xToken() return value. Or, if the
 input buffer is exhausted, xTokenize() should return SQLITE\_OK. Finally,
 if an error occurs with the xTokenize() implementation itself, it
 may abandon the tokenization and return any error code other than
 SQLITE\_OK or SQLITE\_DONE.





