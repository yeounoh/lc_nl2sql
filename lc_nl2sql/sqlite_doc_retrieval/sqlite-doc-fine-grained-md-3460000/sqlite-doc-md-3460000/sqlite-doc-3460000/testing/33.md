## 7\.5\. Measuring branch coverage


Branch coverage in SQLite is currently measured
using [gcov](https://gcc.gnu.org/onlinedocs/gcc/Gcov.html) with the "\-b"
option. First the test program is compiled using options
"\-g \-fprofile\-arcs \-ftest\-coverage" and then the test program is run.
Then "gcov \-b" is run to generate a coverage report.
The coverage report is verbose and inconvenient to read,
so the gcov\-generated report is processed using
some simple scripts to put it into a more human\-friendly format.
This entire process is automated using scripts, of course.



Note that running SQLite with gcov is not a test of SQLite â€”
it is a test of the test suite. The gcov run does not test SQLite because
the \-fprofile\-args and \-ftest\-coverage options cause the compiler to
generate different code.
The gcov run merely verifies that the test suite provides 100% branch test
coverage. The gcov run is a test of the test \- a meta\-test.



After gcov has been run to verify 100% branch test coverage,
then the test program is recompiled using delivery compiler options
(without the special \-fprofile\-arcs and \-ftest\-coverage options)
and the test program is rerun.
This second run is the actual test of SQLite.



It is important to verify that the gcov test run
and the second real test run both give the same output. Any
differences in output indicate either the use of undefined or
indeterminate behavior in the SQLite code (and hence a bug),
or a bug in the compiler.
Note that SQLite has, over the previous decade, encountered bugs
in each of GCC, Clang, and MSVC. Compiler bugs, while rare, do happen,
which is why it is so important to test the code in an as\-delivered
configuration.




