## 2\.3\. Changeset Construction


 After a session object has been configured, it begins monitoring for
changes to its configured tables. However, it does not record an entire
change each time a row within the database is modified. Instead, it records
just the PRIMARY KEY fields for each inserted row, and just the PRIMARY KEY
and all original row values for any updated or deleted rows. If a row is
modified more than once by a single session, no new information is recorded.



 The other information required to create a changeset or patchset is
read from the database file when [sqlite3session\_changeset()](session/sqlite3session_changeset.html) or
[sqlite3session\_patchset()](session/sqlite3session_patchset.html) is called. Specifically,



* For each primary key recorded as a result of an INSERT operation,
 the sessions module checks if there is a row with a matching primary
 key still in the table. If so, an INSERT change is added to the
 changeset.
* For each primary key recorded as a result of an UPDATE or DELETE
 operation, the sessions module also checks for a row with a matching
 primary key within the table. If one can be found, but one or more
 of the non\-PRIMARY KEY fields does not match the original recorded
 value, an UPDATE is added to the changeset. Or, if there is no row
 at all with the specified primary key, a DELETE is added to the
 changeset. If the row does exist but none of the non\-PRIMARY KEY
 fields have been modified, no change is added to the changeset.


 One implication of the above is that if a change is made and then
unmade within a single session (for example if a row is inserted and then
deleted again), the sessions module does not report any change at all. Or
if a row is updated multiple times within the same session, all updates
are coalesced into a single update within any changeset or patchset blob.



