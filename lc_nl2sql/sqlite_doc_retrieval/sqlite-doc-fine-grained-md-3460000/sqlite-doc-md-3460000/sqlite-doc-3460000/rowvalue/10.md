## 3\.4\. Update multiple columns of a table based on a query


The row\-value notation is useful for updating two or more columns
of a table from the result of a single query.
An example of this is in the full\-text search feature of the
[Fossil version control system](https://www.fossil-scm.org/).



In the Fossil full\-text search system,
documents that participate in the full\-text search (wiki pages, tickets,
check\-ins, documentation files, etc) are tracked by a table called
"ftsdocs" (full text search documents).
As new documents are added to the repository, they are not indexed right
away. Indexing is deferred until there is a search request. The
ftsdocs table contains an "idxed" field which is true if the document
has been indexed and false if not.



When a search request occurs and pending documents are indexed for the
first time, the ftsdocs table must be updated by setting the idxed column
to true and also filling in several other columns with information pertinent
to the search. That other information is obtained from a join. The
query is this:




```
UPDATE ftsdocs SET
  idxed=1,
  name=NULL,
  (label,url,mtime) = 
      (SELECT printf('Check-in [%%.16s] on %%s',blob.uuid,
                     datetime(event.mtime)),
              printf('/timeline?y=ci&c=%%.20s',blob.uuid),
              event.mtime
         FROM event, blob
        WHERE event.objid=ftsdocs.rid
          AND blob.rid=ftsdocs.rid)
WHERE ftsdocs.type='c' AND NOT ftsdocs.idxed

```

(See the 
[source code](https://www.fossil-scm.org/fossil/artifact/e5d6a82d?ln=1594-1605)
for further detail. Other examples
[here](https://www.fossil-scm.org/fossil/artifact/e5d6a82d?ln=1618-1628) and
[here](https://www.fossil-scm.org/fossil/artifact/e5d6a82d?ln=1641-1650).)



Five out of nine columns in the ftsdocs table are updated. Two of
the modified columns, "idxed" and "name", can be updated independently of
the query. But the three columns "label", "url", and "mtime" all require
a join query against the "event" and "blob" tables. Without row values,
the equivalent UPDATE would require that the join be repeated three times, 
once for each column to be updated.



