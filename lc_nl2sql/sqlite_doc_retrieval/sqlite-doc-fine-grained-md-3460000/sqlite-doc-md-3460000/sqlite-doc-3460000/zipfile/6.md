### 3\.2\.1\. Adding Entries to a Zip Archive


Entries may be added to a zip archive by inserting new rows. The easiest
way to do this is to specify values for the "name" and "data" columns only and
have zipfile fill in sensible defaults for other fields. To insert a directory
into the archive, set the "data" column to NULL. For example, to add the
directory "dir1" and the file "m.txt" containing the text "abcdefghi" to zip
archive "test.zip":




```
INSERT INTO temp.zip(name, data) VALUES('dir1', NULL);           -- Add directory 
INSERT INTO temp.zip(name, data) VALUES('m.txt', 'abcdefghi');   -- Add regular file 

```

When a directory is inserted, if the "name" value does not end with
a '/' character, the zipfile module appends one. This is necessary for
compatibility with other programs (most notably "info\-zip") that 
manipulate zip archives.



To insert a symbolic link, the user must also supply a "mode" value.
For example, to add a symbolic link from "link.txt" to "m.txt":




```
INSERT INTO temp.zip(name, mode, data) VALUES('link.txt', 'lrwxrw-rw-', 'm.txt');

```

The following rules and caveats apply to the values specified as part of
each INSERT statement:





| Columns | Notes |
| --- | --- |
| name | A non\-NULL text value must be specified for the name column.   It is an error if the specified name already exists in the  archive. |
| mode | If NULL is inserted into the mode column, then the mode of the  new archive entry is automatically set to either 33188 (\-rw\-r\-\-r\-\-)  or 16877 (drwxr\-xr\-x), depending on whether or not the values   specified for columns "sz", "data" and "rawdata" indicate that  the new entry is a directory.    If the specified value is an integer (or text that looks like  an integer), it is inserted verbatim. If the value is not a valid UNIX  mode, some programs may behave unexpectedly when extracting files  from the archive.   Finally, if the value specified for this column is not an integer  or a NULL, then it is assumed to be a UNIX permissions string similar  to those output by the "ls \-l" command (e.g. "\-rw\-r\-\-r\-\-", "drwxr\-xr\-x"  etc.). In this case, if the string cannot be parsed it is an error. |
| mtime | If NULL is inserted into the mtime column, then the timestamp  of the new entry is set to the current time. Otherwise, the specified  value is interpreted as an integer and used as is. |
| sz | This column must be set to NULL. If a non\-NULL value is inserted into  this column, or if a new non\-NULL value is provided using an UPDATE  statement, it is an error. |
| rawdata | This column must be set to NULL. If a non\-NULL value is inserted into  this column, or if a new non\-NULL value is provided using an UPDATE  statement, it is an error. |
| data | To insert a directory into the archive, this field must be set to   NULL. In this case if a value was explicitly specified for the "mode"  column, then it must be consistent with a directory (i.e. it must be  true that (mode \& 0040000\)\=0040000\).    Otherwise, the value inserted into this field is the file contents  for a regular file, or the target of a symbolic link. |
| method | This field must be set one of integer values 0 and 8, or else to  NULL.    For a directory entry, any value inserted into this field is ignored.  Otherwise, if it is set to 0, then the file data or symbolic link  target is stored as is in the zip archive and the compression method  set to 0\. If it is set to 8, then the file data or link target is  compressed using deflate compression before it is stored and the  compression method set to 8\. Finally, if a NULL value is written  to this field, the zipfile module automatically decides whether  or not to compress the data before storing it. |


 Specifying an explicit value for the rowid field as part of an INSERT
statement is not supported. Any value supplied is ignored.



