## 4\.2\.  Fixing The Problem


Running [ANALYZE](lang_analyze.html) on the repository database immediately fixed the
performance problem. However, we want Fossil to be robust and to always
work quickly regardless of whether or not its repository has been analyzed.
For this reason, the query was modified to use the CROSS JOIN operator
instead of the plain JOIN operator.
SQLite will not reorder the tables of a CROSS JOIN.
This is a long\-standing feature of SQLite that is specifically designed
to allow knowledgeable programmers
to enforce a particular loop nesting order. Once the join
was changed to CROSS JOIN (the addition of a single keyword) the NGQP was
forced to choose the faster algorithm\-1 regardless of whether or not
statistical information had been gathered using ANALYZE.


We say that algorithm\-1 is "faster", but this
is not strictly true. Algorithm\-1 is faster in common repositories, but
it is possible to construct a repository in which
every check\-in is on a different uniquely\-named branch and
all check\-ins are children of the root check\-in.
In that case, TAGXREF\_I1 would become more selective
than PLINK\_I1 and algorithm\-2 really would be the faster choice.
However such repositories are very unlikely to appear in
practice and so hard\-coding the loop nested order using the
CROSS JOIN syntax is a reasonable solution
to the problem in this case.


