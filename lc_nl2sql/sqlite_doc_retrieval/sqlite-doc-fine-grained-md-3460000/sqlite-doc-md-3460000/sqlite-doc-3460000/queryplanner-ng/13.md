## 4\.3\. Update 2017: A Better Fix


The prior text was written in early 2013, before the first release of
SQLite version 3\.8\.0\. This paragraph was added in mid 2021\.
While all of the previous discussion remains true, a lot of improvements
have been made to the query planner, making this whole section largely moot.



In 2017, Fossil was enhanced to make use of the new
[PRAGMA optimize](pragma.html#pragma_optimize) statement. Whenever Fossil is about to close the
database connection to its repository, it first runs
"PRAGMA optimize", which will in turn cause ANALYZE to be run if it
is needed. Usually an ANALYZE is not needed, and so there is no
measurable performance penalty for doing this. But every now and
then ANALYZE might be run on a few of the tables in the repository
database. Because if this, query planning issues such as the one
described here no longer come up in Fossil. The fact that ANALYZE
is run periodically to keep the [sqlite\_stat1](fileformat2.html#stat1tab) table up\-to\-date means
that hand\-tuning of queries is no longer required. We have not had
to tweak a query in Fossil in ages.



Therefore, the current recommendation for avoiding problems such
as this one is to simply run "PRAGMA optimize" just prior to closing
each database connection. Or, if your application is long\-running and
never closes any database connections, then run "PRAGMA optimize" once
per day or so. Also consider running "PRAGMA optimize" after any
schema change.




