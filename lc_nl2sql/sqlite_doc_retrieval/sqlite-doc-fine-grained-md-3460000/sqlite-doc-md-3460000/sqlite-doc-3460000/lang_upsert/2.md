# 2\. Description


UPSERT is a clause added to [INSERT](lang_insert.html) that causes the
INSERT to behave as an [UPDATE](lang_update.html) or a no\-op if the INSERT would violate
a uniqueness constraint.
UPSERT is not standard SQL. UPSERT in SQLite follows the
syntax established by PostgreSQL, with generalizations.



An UPSERT is an ordinary [INSERT](lang_insert.html) statement that is followed by
one or more ON CONFLICT clauses, as shown in the syntax diagram above.



The syntax in between the "ON CONFLICT" and "DO" keywords
is called the "conflict target". The conflict target specifies a
uniqueness constraint that will trigger the upsert. The conflict target
may be omitted on the last ON CONFLICT clause in the INSERT statement, but
is required for all other ON CONFLICT clauses.



If the insert operation would cause the conflict target uniqueness
constraint to fail, then the insert is omitted and
the corresponding DO NOTHING or DO UPDATE operation is performed instead.
The ON CONFLICT clauses are checked in the order specified. If the last
ON CONFLICT clause omits the conflict target, then it will fire if any
uniqueness constraint fails which is not captured by prior ON CONFLICT clauses.



Only a single ON CONFLICT clause, specifically the first ON CONFLICT
clause with a matching conflict target, may run for each row of the INSERT.
When an ON CONFLICT clause fires, all subsequent ON CONFLICT clauses are
bypassed for that one row.




In the case of a multi\-row insert, the upsert decision is made separately
for each row of the insert.



The UPSERT processing happens only for uniqueness constraints.
A "uniqueness constraint"
is an explicit UNIQUE or PRIMARY KEY constraint within
the CREATE TABLE statement, or a [unique index](lang_createindex.html#uniqueidx).
UPSERT does not intervene for failed NOT NULL, CHECK,
or foreign key constraints
or for constraints that are implemented using triggers.



Column names in the expressions of a DO UPDATE refer to the original
unchanged value of the column, before the attempted INSERT. To use the
value that would have been inserted had the constraint not failed,
add the special "excluded." table qualifier to the column name.



