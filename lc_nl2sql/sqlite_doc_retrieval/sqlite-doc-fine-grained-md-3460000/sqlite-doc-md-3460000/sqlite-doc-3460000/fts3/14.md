## 4\.2\. The Snippet Function



 The snippet function is used to create formatted fragments of document text
 for display as part of a full\-text query results report. The snippet function
 may be passed between one and six arguments, as follows:





| Argument | Default Value | Description |
| --- | --- | --- |
| 0 | N/A | The first argument to the snippet function must always be the [FTS hidden column](fts3.html#hiddencol)  of the FTS table being queried and from which the snippet is to be taken. The  [FTS hidden column](fts3.html#hiddencol) is an automatically generated column with the same name as the  FTS table itself. |
| 1 | "\<b\>" | The "start match" text. |
| 2 | "\</b\>" | The "end match" text. |
| 3 | "\<b\>...\</b\>" | The "ellipses" text. |
| 4 | \-1 | The FTS table column number to extract the returned fragments of  text from. Columns are numbered from left to right starting with  zero. A negative value indicates that the text may be extracted  from any column. |
| 5 | \-15 | The absolute value of this integer argument is used as the  (approximate) number of tokens to include in the returned text  value. The maximum allowable absolute value is 64\. The value of  this argument is referred to as *N* in the discussion below. |



 The snippet function first attempts to find a fragment of text consisting
 of *\|N\|* tokens within the current row that contains at least one phrase
 match for each matchable phrase matched somewhere in the current row,
 where *\|N\|* is the absolute value of the sixth argument passed to the
 snippet function. If the text stored in a single column contains less than
 *\|N\|* tokens, then the entire column value is considered. Text fragments
 may not span multiple columns.




 If such a text fragment can be found, it is returned with the following
 modifications:



* If the text fragment does not begin at the start of a column value,
 the "ellipses" text is prepended to it.
* If the text fragment does not finish at the end of a column value,
 the "ellipses" text is appended to it.
* For each token in the text fragment that is part of a phrase match,
 the "start match" text is inserted into the fragment before the token,
 and the "end match" text is inserted immediately after it.



 If more than one such fragment can be found, then fragments that contain
 a larger number of "extra" phrase matches are favored. The start of
 the selected text fragment may be moved a few tokens forward or backward
 to attempt to concentrate the phrase matches toward the center of the
 fragment.




 Assuming *N* is a positive value, if no fragments can be found that
 contain a phrase match corresponding to each matchable phrase, the snippet
 function attempts to find two fragments of approximately *N*/2 tokens
 that between them contain at least one phrase match for each matchable phrase
 matched by the current row. If this fails, attempts are made to find three
 fragments of *N*/3 tokens each and finally four *N*/4 token
 fragments. If a set of four fragments cannot be found that encompasses the
 required phrase matches, the four fragments of *N*/4 tokens that provide
 the best coverage are selected.




 If *N* is a negative value, and no single fragment can be found
 containing the required phrase matches, the snippet function searches
 for two fragments of *\|N\|* tokens each, then three, then four. In
 other words, if the specified value of *N* is negative, the sizes
 of the fragments is not decreased if more than one fragment is required
 to provide the desired phrase match coverage.




 After the *M* fragments have been located, where *M* is between
 two and four as described in the paragraphs above, they are joined together
 in sorted order with the "ellipses" text separating them. The three
 modifications enumerated earlier are performed on the text before it is
 returned.




```
Note: In this block of examples, newlines and whitespace characters have
been inserted into the document inserted into the FTS table, and the expected
results described in SQL comments. This is done to enhance readability only,
they would not be present in actual SQLite commands or output.

-- Create and populate an FTS table.
CREATE VIRTUAL TABLE text USING fts4();
INSERT INTO text VALUES('
  During 30 Nov-1 Dec, 2-3oC drops. Cool in the upper portion, minimum temperature 14-16oC
  and cool elsewhere, minimum temperature 17-20oC. Cold to very cold on mountaintops,
  minimum temperature 6-12oC. Northeasterly winds 15-30 km/hr. After that, temperature
  increases. Northeasterly winds 15-30 km/hr.
');

-- The following query returns the text value:
--
--   "<b>...</b>cool elsewhere, minimum temperature 17-20oC. <b>Cold</b> to very 
--    <b>cold</b> on mountaintops, minimum temperature 6<b>...</b>".
--
SELECT snippet(text) FROM text WHERE text MATCH 'cold';

-- The following query returns the text value:
--
--   "...the upper portion, [minimum] [temperature] 14-16oC and cool elsewhere,
--    [minimum] [temperature] 17-20oC. Cold..."
--
SELECT snippet(text, '[', ']', '...') FROM text WHERE text MATCH '"min* tem*"'

```


