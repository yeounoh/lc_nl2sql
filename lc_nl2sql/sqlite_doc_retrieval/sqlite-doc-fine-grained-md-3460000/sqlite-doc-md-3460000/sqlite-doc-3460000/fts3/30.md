## 7\.4\. The "merge\=X,Y" command



 The "merge\=X,Y" command (where X and Y are integers) causes SQLite
 to do a limited amount of work toward merging the various inverted
 index b\-trees of an FTS3/4 table together into one large b\-tree.
 The X value is the target number of "blocks" to be merged, and Y is
 the minimum number of b\-tree segments on a level required before
 merging will be applied to that level. The value of Y should
 be between 2 and 16 with a recommended value of 8\. The value of X
 can be any positive integer but values on the order of 100 to 300
 are recommended.




 When an FTS table accumulates 16 b\-tree segments at the same level,
 the next INSERT into that table will cause all 16 segments to be
 merged into a single b\-tree segment at the next higher level. The
 effect of these level merges is that most INSERTs into an FTS table
 are very fast and take minimal memory, but an occasional INSERT is
 slow and generates a large transaction because of the need to
 do merging. This results in "spiky" performance of INSERTs.




 To avoid spiky INSERT performance, an application can run the
 "merge\=X,Y" command periodically, possibly in an idle thread or
 idle process, to ensure that the FTS table never accumulates
 too many b\-tree segments at the same level. INSERT performance
 spikes can generally be avoided, and performance of FTS3/4 can be
 maximized, by running "merge\=X,Y" after every few thousand
 document inserts. Each "merge\=X,Y" command will run in a separate
 transaction (unless they are grouped together using [BEGIN](lang_transaction.html)...[COMMIT](lang_transaction.html),
 of course). The transactions can be kept small by choosing a value
 for X in the range of 100 to 300\. The idle thread that is running
 the merge commands can know when it is done by checking the difference
 in [sqlite3\_total\_changes()](c3ref/total_changes.html) before and after each "merge\=X,Y"
 command and stopping the loop when the difference drops below two.




