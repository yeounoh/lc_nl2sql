# 3\. How VACUUM works


The VACUUM command works by copying the contents of the database into
a temporary database file and then overwriting the original with the
contents of the temporary file. When overwriting the original, a rollback
journal or [write\-ahead log](wal.html) WAL file is used just as it would be for any
other database transaction. This means that when VACUUMing a database,
as much as twice the size of the original database file is required in free
disk space.



The VACUUM INTO command works the same way except that it uses the file
named on the INTO clause in place of the temporary database and omits the
step of copying the vacuumed database back over top of the original database.



The VACUUM command may change the [ROWIDs](lang_createtable.html#rowid) of entries in any
tables that do not have an explicit [INTEGER PRIMARY KEY](lang_createtable.html#rowid).



A VACUUM will fail if there is an open transaction on the database
connection that is attempting to run the VACUUM. Unfinalized SQL
statements typically hold a read transaction open, so the VACUUM
might fail if there are unfinalized SQL statements on the same connection.
VACUUM (but not VACUUM INTO) is a write operation and so if another
database connection is holding a lock that prevents writes, then
the VACUUM will fail.



An alternative to using the VACUUM command to
reclaim space after data has been deleted is auto\-vacuum mode, enabled using
the [auto\_vacuum](pragma.html#pragma_auto_vacuum) pragma. When [auto\_vacuum](pragma.html#pragma_auto_vacuum) is enabled for a database
free pages may be reclaimed after deleting data, causing the file to shrink,
without rebuilding the entire database using VACUUM. However, using
[auto\_vacuum](pragma.html#pragma_auto_vacuum) can lead to extra database file fragmentation. And [auto\_vacuum](pragma.html#pragma_auto_vacuum)
does not compact partially filled pages of the database as VACUUM does.




*This page last modified on [2023\-12\-05 14:43:20](https://sqlite.org/docsrc/honeypot) UTC* 


