### The "function" method


The "function" method registers new SQL functions with the SQLite engine.
The arguments are the name of the new SQL function and a TCL command that
implements that function. Arguments to the function are appended to the
TCL command before it is invoked.



For security reasons, it is recommended that applications first set
[PRAGMA trusted\_schema\=OFF](pragma.html#pragma_trusted_schema) or run the
"[db config trusted\_schema 0](#config)"
method before using this method.



The syntax looks like this:




> *dbcmd*  **function**
>   *sql\-name*
>   *?options?*
>   *script*



The following example creates a new SQL function named "hex" that converts
its numeric argument in to a hexadecimal encoded string:




> **db function hex {format 0x%X}**


The "function" method accepts the following options:

> **\-argcount** *INTEGER*
> 
> Specify the number of arguments that the SQL function accepts. The default
> value of \-1 means any number of arguments.
> 
> **\-deterministic**
> 
> This option indicates that the function will always return the same
> answer given the same argument values. The SQLite query optimizer
> uses this information to cache answers from function calls with
> constant inputs and reuse the result rather than invoke the function
> repeatedly.
> 
> 
> 
> **\-directonly**
> 
> This option restricts the function to only be usable by direct
> top\-level SQL statement. The function will not be accessible to
> triggers, views, CHECK constraints, generated columns, or index
> expressions. This option is recommended for all application\-defined
> SQL functions, and is highly recommended for any SQL
> function that has side effects or that reveals internal state of
> the application.
> 
> **Security Warning:**
> Without this switch, an attacker might be able to change the
> schema of a database file to include the new function inside a trigger
> or view or CHECK constraint and thereby trick the application into
> running the function with parameters of the attacker's choosing.
> Hence, if the new function has side effects or reveals internal
> state about the application and the \-directonly option is not
> used, that is a potential security vulnerability.
> 
> 
> 
> 
> 
> **\-innocuous**
> 
> This option indicates that the function has no side effects and
> does not leak any information that cannot be computed directly
> from its input parameters. When this option is specified, the
> function may be used in triggers, views, CHECK constraints,
> generated columns, and/or index expressions even if
> [PRAGMA trusted\_schema\=OFF](pragma.html#pragma_trusted_schema). The use of this option is discouraged
> unless it is truly needed.
> 
> 
> 
> **\-returntype integer\|real\|text\|blob\|any**
> 
> This option is used to configure the type of the result returned by the
> function. If this option is set to "any" (the default), SQLite attempts to
> determine the type of each value returned by the function implementation based
> on the Tcl value's internal type. Or, if it is set to "text" or "blob", the
> returned value is always a text or blob value, respectively. If this option is
> set to "integer", SQLite attempts to coerce the value returned by the function
> to an integer. If this is not possible without data loss, it attempts to coerce
> it to a real value, and finally falls back to text. If this option is set to
> "real", an attempt is made to return a real value, falling back to text if this
> is not possible.



