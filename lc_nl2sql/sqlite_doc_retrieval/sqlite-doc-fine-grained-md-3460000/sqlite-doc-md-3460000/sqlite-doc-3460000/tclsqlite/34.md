### The "trace\_v2" method


The "trace\_v2" method registers a callback that is invoked as each SQL
statement is compiled. The syntax is as follows:



> *dbcmd*  **trace\_v2**  ?*callback*?  ?*mask*?


This command causes the "callback" script to be invoked whenever
certain conditions occurs. The conditions are determined by the *mask*
argument, which should be a TCL\-list of zero or more of the following
keywords:

* **statement*** **profile*** **row*** **close**


Traces for **statement** invoke the callback with two arguments
whenever a new SQL statement is run.
The first argument is an integer which is the value of the pointer
to the underlying [sqlite3\_stmt](c3ref/stmt.html) object. This integer can be used
to correlate SQL statement text with the result of a **profile**
or **row** callback. The second argument is the
unexpanded text of the SQL statement being run. By "unexpanded", we
mean that variable substitutions in the text are not expanded into the
variable values. This is different from the behavior of the "trace"
method which does expand variable substitutions.

Traces for **profile** invoke the callback with two arguments
as each SQL statement finishes. The first argument is an integer which
is the value of the underlying [sqlite3\_stmt](c3ref/stmt.html) object. The second
argument is the approximate run\-time for the statement in nanoseconds.
The run\-time is the best estimate available depending on the capabilities
of the platform on which the application is running.

Traces for **row** invoke the callback with a single argument
whenever a new result row is available from an SQL statement.
The argument is an integer which is the value of the underlying
[sqlite3\_stmt](c3ref/stmt.html) object pointer.

Traces for **close** invoke the callback with a single argument
as the database connection is closing. The argument is an integer which
is the value of a pointer to the underlying [sqlite3](c3ref/sqlite3.html) object that is
closing.

There can only be a single trace callback registered on a database
connection. Each use of "trace" or "trace\_v2" cancels all prior
trace callback.

