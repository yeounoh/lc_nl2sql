## 3\.1\. Pointer Types



The "pointer type" in the last parameter to [sqlite3\_bind\_pointer()](c3ref/bind_blob.html),
[sqlite3\_result\_pointer()](c3ref/result_blob.html), and [sqlite3\_value\_pointer()](c3ref/value_blob.html) is used to prevent
pointers intended for one extension from being redirected to a different
extension. For example, without the use of pointer types, an attacker 
could still get access to pointer information in a system that included 
both the [FTS3](fts3.html) and the [CARRAY extension](carray.html) using SQL like this:




```
SELECT ca.value FROM t1, carray(t1,10) AS ca WHERE cx MATCH $pattern

```


In the statement above, the FTS3 cursor pointer generated by the
MATCH operator is send into the carray() table\-valued function instead
of its intended recipient snippet(). The carray() function treats the
pointer as a pointer to an array of integers and returns each integer
one by one, thus leaking the content of the FTS3 cursor object. Since
the FTS3 cursor object contains pointers to other objects, the statement
above would be a pointer leak.




Except, the statement above does not work, thanks to pointer types.
The pointer generated by the MATCH operator has a type of "fts3cursor"
but the carray() function expects to receives a pointer of type "carray".
Because the pointer type on the [sqlite3\_result\_pointer()](c3ref/result_blob.html) does not match
the pointer type on the [sqlite3\_value\_pointer()](c3ref/value_blob.html) call, 
[sqlite3\_value\_pointer()](c3ref/value_blob.html) returns NULL in carray() and thus signals
the CARRAY extension that it has been passed an invalid pointer.



