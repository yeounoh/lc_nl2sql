## 4\.5\. Reader Algorithm


To read a page from the database (call it page number P), a reader
first checks the WAL to see if it contains page P. If so, then the
last valid instance of page P that is followed by a commit frame
or is a commit frame itself becomes the value read. If the WAL
contains no copies of page P that are valid and which are a commit
frame or are followed by a commit frame, then page P is read from
the database file.


To start a read transaction, the reader records the number of value
frames in the WAL as "mxFrame". ([More detail](walformat.html#mxframe))
The reader uses this recorded mxFrame value
for all subsequent read operations. New transactions can be appended
to the WAL, but as long as the reader uses its original mxFrame value
and ignores subsequently appended content, the reader will see a 
consistent snapshot of the database from a single point in time. 
This technique allows multiple concurrent readers to view different 
versions of the database content simultaneously.


The reader algorithm in the previous paragraphs works correctly, but 
because frames for page P can appear anywhere within the WAL, the
reader has to scan the entire WAL looking for page P frames. If the
WAL is large (multiple megabytes is typical) that scan can be slow,
and read performance suffers. To overcome this problem, a separate
data structure called the wal\-index is maintained to expedite the
search for frames of a particular page.



