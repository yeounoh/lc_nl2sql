## SQLite Release 3\.21\.0 On 2017\-10\-24

1. Take advantage of the atomic\-write capabilities in the
 [F2FS filesystem](https://en.wikipedia.org/wiki/F2FS) when available, for
 greatly reduced transaction overhead. This currently requires the
 [SQLITE\_ENABLE\_BATCH\_ATOMIC\_WRITE](../compile.html#enable_batch_atomic_write) compile\-time option.
- Allow [ATTACH](../lang_attach.html) and [DETACH](../lang_detach.html) commands to work inside of a transaction.
- Allow [WITHOUT ROWID virtual tables](../vtab.html#worid) to be writable if the PRIMARY KEY
 contains exactly one column.
- The "fsync()" that occurs after the header is written in a WAL reset
 now uses the sync settings for checkpoints. This means it will use a
 "fullfsync" on macs if [PRAGMA checkpoint\_fullfsync](../pragma.html#pragma_checkpoint_fullfsync) set on.
- The [sqlite3\_sourceid()](../c3ref/libversion.html) function tries to detect if the source code has
 been modified from what is checked into version control and if there are
 modifications, the last four characters of the version hash are shown as
 "alt1" or "alt2". The objective is to detect accidental and/or careless
 edits. A forger can subvert this feature.
- Improved de\-quoting of column names for [CREATE TABLE AS](../lang_createtable.html#createtabas) statements with
 an aggregate query on the right\-hand side.
- Fewer "stat()" system calls issued by the unix VFS.
- Enhanced the [LIKE optimization](../optoverview.html#like_opt) so that it works with an [ESCAPE](../lang_expr.html#like) clause.
- Enhanced [PRAGMA integrity\_check](../pragma.html#pragma_integrity_check) and [PRAGMA quick\_check](../pragma.html#pragma_quick_check) to detect obscure
 row corruption that they were formerly missing. Also update both pragmas
 so that they return error text rather than SQLITE\_CORRUPT when encountering
 corruption in [records](../fileformat2.html#record_format).
- The query planner now prefers to implement FROM\-clause subqueries using
 [co\-routines](../optoverview.html#coroutines) rather using the [query flattener](../optoverview.html#flattening) optimization. Support for
 the use of co\-routines for subqueries may no longer be disabled.
- Pass information about !\=, IS, IS NOT, NOT NULL, and IS NULL constraints
 into the [xBestIndex](../vtab.html#xbestindex) method of virtual tables.
- Enhanced the [CSV virtual table](../csv.html) so that it accepts the last row of
 input if the final new\-line character is missing.
- Remove the rarely\-used "scratch" memory allocator. Replace it with the
 [SQLITE\_CONFIG\_SMALL\_MALLOC](../c3ref/c_config_covering_index_scan.html#sqliteconfigsmallmalloc) configuration setting that gives SQLite
 a hint that large memory allocations should be avoided when possible.
- Added the
 [swarm virtual table](https://sqlite.org/src/file/ext/misc/unionvtab.c)
 to the existing union virtual table extension.
- Added the
 [sqlite\_dbpage virtual table](https://sqlite.org/src/file/src/dbpage.c)
 for providing direct access to pages
 of the database file. The source code is built into the [amalgamation](../amalgamation.html) and
 is activated using the [\-DSQLITE\_ENABLE\_DBPAGE\_VTAB](../compile.html#enable_dbpage_vtab) compile\-time option.
- Add a new type of fts5vocab virtual table \- "instance" \- that provides
 direct access to an FTS5 full\-text index at the lowest possible level.
- Remove a call to rand\_s() in the Windows VFS since it was causing problems
 in Firefox on some older laptops.
- The [src/shell.c](https://sqlite.org/src/finfo?name=src/shell.c) source code
 to the [command\-line shell](../cli.html) is no longer under version control. That file
 is now generated as part of the build process.
- Miscellaneous [microoptimizations](../cpu.html#microopt) reduce CPU usage by about 2\.1%.
- Bug fixes:
	1. Fix a faulty assert() statement discovered by OSSFuzz.
	 Ticket [cb91bf4290c211d](https://sqlite.org/src/info/cb91bf4290c211d)- Fix an obscure memory leak in [sqlite3\_result\_pointer()](../c3ref/result_blob.html).
	 Ticket [7486aa54b968e9b](https://sqlite.org/src/info/7486aa54b968e9b)- Avoid a possible use\-after\-free error by deferring schema resets until
	 after the query planner has finished running.
	 Ticket [be436a7f4587ce5](https://sqlite.org/src/info/be436a7f4587ce5)- Only use indexes\-on\-expressions to optimize ORDER BY or GROUP BY if
	 the COLLATE is correct.
	 Ticket [e20dd54ab0e4383](https://sqlite.org/src/info/e20dd54ab0e4383)- Fix an assertion fault that was coming up when the expression in an
	 index\-on\-expressions is really a constant.
	 Ticket [aa98619ad08ddca](https://sqlite.org/src/info/aa98619ad08ddca)- Fix an assertion fault that could occur following
	 [PRAGMA reverse\_unordered\_selects](../pragma.html#pragma_reverse_unordered_selects).
	 Ticket [cb91bf4290c211d](https://sqlite.org/src/info/cb91bf4290c211d)- Fix a segfault that can occur for queries that use table\-valued functions
	 in an IN or EXISTS subquery.
	 Ticket [b899b6042f97f5](https://sqlite.org/src/info/b899b6042f97f5)- Fix a potential integer overflow problem when compiling a particular
	 horrendous common table expression. This was another problem discovered
	 by OSSFuzz. Check\-in [6ee8cb6ae5](https://sqlite.org/src/info/6ee8cb6ae5).
	 - Fix a potential out\-of\-bound read when querying a corrupt database file,
	 a problem detected by Natalie Silvanovich of Google Project Zero.
	 Check\-in [04925dee41a21f](https://sqlite.org/src/info/04925dee41a21f).**Hashes:**
- SQLITE\_SOURCE\_ID: "2017\-10\-24 18:55:49 1a584e499906b5c87ec7d43d4abce641fdf017c42125b083109bc77c4de48827"
- SHA3\-256 for sqlite3\.c: 84c181c0283d0320f488357fc8aab51898370c157601459ebee49d779036fe03



A [complete list of SQLite releases](../changes.html)
 in a single page and a [chronology](../chronology.html) are both also available.
 A detailed history of every
 check\-in is available at
 [SQLite version control site](https://www.sqlite.org/src/timeline).


