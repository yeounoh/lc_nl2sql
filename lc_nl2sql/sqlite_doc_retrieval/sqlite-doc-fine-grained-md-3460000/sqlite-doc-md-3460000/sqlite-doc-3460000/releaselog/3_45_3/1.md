## SQLite Release 3\.45\.3 On 2024\-04\-15

**Prior changes from version 3\.45\.0 (2024\-01\-15\):**


1. Added the [SQLITE\_RESULT\_SUBTYPE](../c3ref/c_deterministic.html#sqliteresultsubtype) property for
 [application\-defined SQL functions](../appfunc.html). 
 All application defined SQL functions that invokes
 [sqlite3\_result\_subtype()](../c3ref/result_subtype.html) must be registered with this new property.
 Failure to do so might cause the call to sqlite3\_result\_subtype() to
 behave as a no\-op. Compile with [\-DSQLITE\_STRICT\_SUBTYPE\=1](../compile.html#strict_subtype) to cause an
 SQL error to be raised if a function that is not [SQLITE\_RESULT\_SUBTYPE](../c3ref/c_deterministic.html#sqliteresultsubtype)
 tries invokes [sqlite3\_result\_subtype()](../c3ref/result_subtype.html). The use of [\-DSQLITE\_STRICT\_SUBTYPE\=1](../compile.html#strict_subtype)
 is a recommended compile\-time option for every application that makes
 use of subtypes.
- Enhancements to the [JSON SQL functions](../json1.html):
	1. All JSON functions are rewritten to use a new internal parse tree
	 format called [JSONB](../json1.html#jsonbx). The new parse\-tree format is serializable 
	 and hence can be stored in the database to avoid unnecessary re\-parsing
	 whenever the JSON value is used.
	 - New versions of JSON\-generating functions generate binary JSONB instead
	 of JSON text.
	 - The [json\_valid()](../json1.html#jvalid) function adds an optional second argument that
	 specifies what it means for the first argument to be "well\-formed".- Add the [FTS5 tokendata option](../fts5.html#the_tokendata_option) to the [FTS5](../fts5.html) virtual table.
- The [SQLITE\_DIRECT\_OVERFLOW\_READ](../compile.html#direct_overflow_read) optimization is now enabled by default.
 Disable it at compile\-time using \-DSQLITE\_DIRECT\_OVERFLOW\_READ\=0\.
- Query planner improvements:
	1. Do not allow the transitive constraint optimization to trick the
	 query planner into using a range constraint when a better equality
	 constraint is available.
	 ([Forum post 2568d1f6e6](https://sqlite.org/forum/forumpost/2568d1f6e6).)
	 - The query planner now does a better job of disregarding
	 indexes that [ANALYZE](../lang_analyze.html) identifies as low\-quality.
	 ([Forum post 6f0958b03b](https://sqlite.org/forum/forumpost/6f0958b03b).)- Increase the default value for [SQLITE\_MAX\_PAGE\_COUNT](../limits.html#max_page_count) from 1073741824 to
 4294967294\.
- Enhancements to the [CLI](../cli.html):
	1. Improvements to the display of UTF\-8 content on Windows
	 - Automatically detect playback of ".dump" scripts and make appropriate
	 changes to settings such as ".dbconfig defensive off" and
	 ".dbconfig dqs\_dll on".


**Prior changes from version 3\.45\.1 (2024\-01\-30\):**


1. Restore the [JSON BLOB input bug](../json1.html#jblobbug), and promise to support the anomaly in
 subsequent releases, for backward compatibility.
- Fix the [PRAGMA integrity\_check](../pragma.html#pragma_integrity_check) command so that it works on read\-only
 databases that contain FTS3 and FTS5 tables. This resolves an issue
 introduced in [version 3\.44\.0](../releaselog/3_44_0.html) but was undiscovered until after the 3\.45\.0 release.
- Fix issues associated with processing corrupt [JSONB](../json1.html#jsonbx) inputs:
	1. Prevent exponential runtime when converting a corrupt JSONB into text.
	 - Fix a possible read of one byte past the end of the JSONB blob when converting
	 a corrupt JSONB into text.
	 - Enhanced testing using [jfuzz](../testing.html#dbsqlfuzz) to prevent any future JSONB problems such
	 as the above.- Fix a long\-standing bug in which a read of a few bytes past the end of a
 memory\-mapped segment might occur when accessing a craftily corrupted database
 using [memory\-mapped database](../pragma.html#pragma_mmap_size).
- Fix a long\-standing bug in which a NULL pointer dereference might occur in
 the [bytecode engine](../opcode.html) due to incorrect bytecode being generated for a class
 of SQL statements that are deliberately designed to stress the query planner
 but which are otherwise pointless.


**Prior changes from version 3\.45\.2 (2024\-03\-12\):**


1. Fix an error in [UPSERT](../lang_upsert.html), introduced by enhancement 3a in [version 3\.35\.0](../releaselog/3_35_0.html)
 (2021\-03\-12\), that could cause an index to get out\-of\-sync with its table.
 [Forum thread 919c6579c8](https://sqlite.org/forum/forumpost/919c6579c8).
- Reduce the scope of the NOT NULL strength reduction optimization that was
 added as item 8e in [version 3\.35\.0](../releaselog/3_35_0.html) (2021\-03\-12\). The optimization
 was being attempted in some contexts where it did not work, resulting in
 incorrect query results.
 [Forum thread 440f2a2f17](https://sqlite.org/forum/forumpost/440f2a2f17).
- Other trifling corrections and compiler warning fixes that have come up
 since the previous patch release. See the
 [timeline](https://sqlite.org/src/timeline?from=version-3.45.1&to=version-3.45.2&to2=branch-3.45)
 for details.


**Changes in this specific patch release, version 3\.45\.3 (2024\-04\-15\):**


1. Fix a long\-standing bug (going back to [version 3\.24\.0](../releaselog/3_24_0.html))
 that might (rarely) cause the "old.\*" values of an [UPDATE trigger](../lang_createtrigger.html)
 to be incorrect if that trigger fires in response to an [UPSERT](../lang_upsert.html).
 [Forum post 284955a3cd454a15](https://sqlite.org/forum/forumpost/284955a3cd454a15).
- Fix a bug in [sum()](../lang_aggfunc.html#sumunc) that could cause it to return NULL when it should return
 Infinity. [Forum post 23b8688ef4](https://sqlite.org/forum/forumpost/23b8688ef4).
- Other trifling corrections and compiler warning fixes that have come up
 since the previous patch release. See the
 [timeline](https://sqlite.org/src/timeline?from=version-3.45.2&to=version-3.45.3&to2=branch-3.45)
 for details.
**Hashes:**
- SQLITE\_SOURCE\_ID: 2024\-04\-15 13:34:05 8653b758870e6ef0c98d46b3ace27849054af85da891eb121e9aaa537f1e8355
- SHA3\-256 for sqlite3\.c: 21dbe688a71b449d28e2a8ec6a43e7520e54df456e02b6d4f6a1d1c7a998c826



A [complete list of SQLite releases](../changes.html)
 in a single page and a [chronology](../chronology.html) are both also available.
 A detailed history of every
 check\-in is available at
 [SQLite version control site](https://www.sqlite.org/src/timeline).








