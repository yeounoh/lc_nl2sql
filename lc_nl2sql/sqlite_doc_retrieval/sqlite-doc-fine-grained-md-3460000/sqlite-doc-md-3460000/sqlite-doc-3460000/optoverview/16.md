## 8\.2\. Range Queries



 Consider a slightly different scenario:




```
CREATE TABLE ex2(x,y,z);
CREATE INDEX ex2i1 ON ex2(x);
CREATE INDEX ex2i2 ON ex2(y);
SELECT z FROM ex2 WHERE x BETWEEN 1 AND 100 AND y BETWEEN 1 AND 100;

```


 Further suppose that column x contains values spread out
 between 0 and 1,000,000 and column y contains values
 that span between 0 and 1,000\. In that scenario,
 the range constraint on column x should reduce the search space by
 a factor of 10,000 whereas the range constraint on column y should
 reduce the search space by a factor of only 10\. So the ex2i1 index
 should be preferred.




 SQLite will make this determination, but only if it has been compiled
 with [SQLITE\_ENABLE\_STAT3](compile.html#enable_stat3) or [SQLITE\_ENABLE\_STAT4](compile.html#enable_stat4).
 The [SQLITE\_ENABLE\_STAT3](compile.html#enable_stat3) and [SQLITE\_ENABLE\_STAT4](compile.html#enable_stat4) options causes
 the [ANALYZE](lang_analyze.html) command to collect a histogram of column content in the
 [sqlite\_stat3](fileformat2.html#stat3tab) or [sqlite\_stat4](fileformat2.html#stat4tab) tables and to use this histogram to 
 make a better guess at the best query to use for range constraints
 such as the above. The main difference between STAT3 and STAT4 is
 that STAT3 records histogram data for only the left\-most column of
 an index whereas STAT4 records histogram data for all columns of an
 index. For single\-column indexes, STAT3 and STAT4 work the same.




 The histogram data is only useful if the right\-hand side of the constraint
 is a simple compile\-time constant or [parameter](lang_expr.html#varparam) and not an expression.




 Another limitation of the histogram data is that it only applies to the
 left\-most column on an index. Consider this scenario:




```
CREATE TABLE ex3(w,x,y,z);
CREATE INDEX ex3i1 ON ex2(w, x);
CREATE INDEX ex3i2 ON ex2(w, y);
SELECT z FROM ex3 WHERE w=5 AND x BETWEEN 1 AND 100 AND y BETWEEN 1 AND 100;

```


 Here the inequalities are on columns x and y which are not the
 left\-most index columns. Hence, the histogram data which is collected no
 left\-most column of indexes is useless in helping to choose between the
 range constraints on columns x and y.




