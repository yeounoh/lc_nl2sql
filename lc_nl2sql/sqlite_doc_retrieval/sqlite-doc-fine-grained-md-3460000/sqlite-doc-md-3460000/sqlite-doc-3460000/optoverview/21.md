# 12\. Subquery Co\-routines



 SQLite implements FROM\-clause subqueries in one of three ways:
 

1. [Flatten](optoverview.html#flattening) the subquery into its outer query
2. Evaluate the subquery into a transient table that exists for
 the duration of the one SQL statement that is being evaluated,
 then run the outer query against that transient table.
3. Evaluate the subquery in a co\-routine that runs in parallel with
 the outer query, providing rows to the outer query as needed.



 This section describes the third technique: implementing the subquery
 as a co\-routine.




 A co\-routine is like a subroutine in that it runs in the same thread
 as the caller and eventually returns control back to the caller. The
 difference is that a co\-routine also has the ability to return
 before it has finished, and then resume where it left off the next
 time it is called.




 When a subquery is implemented as a co\-routine, byte\-code is generated
 to implement the subquery as if it were a standalone query, except
 instead of returning rows of results back to the application, the
 co\-routine yields control back to the caller after each row is computed.
 The caller can then use that one computed row as part of its computation,
 then invoke the co\-routine again when it is ready for the next row.




 Co\-routines are better than storing the complete result set of the subquery
 in a transient table because co\-routines use less memory. With a co\-routine,
 only a single row of the result needs to be remembered, whereas all rows of
 the result must be stored for a transient table. Also, because the
 co\-routine does not need to run to completion before the outer query
 begins its work, the first rows of output can appear much sooner, and if
 the overall query is abandoned before it has finished, less work is done
 overall.




 On the other hand, if the result of the subquery must be scanned multiple
 times (because, for example, it is just one table in a join) then it
 is better to use a transient table to remember the entire result of the
 subquery, in order to avoid computing the subquery more than once.




