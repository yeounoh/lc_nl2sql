# 15\. The WHERE\-Clause Push\-Down Optimization



 If a subquery cannot be [flattened](optoverview.html#flattening) into the outer query, it might
 still be possible to enhance performance by "pushing down" WHERE clause
 terms from the outer query into the subquery. Consider an example:




```
CREATE TABLE t1(a INT, b INT);
CREATE TABLE t2(x INT, y INT);
CREATE VIEW v1(a,b) AS SELECT DISTINCT a, b FROM t1;

SELECT x, y, b
  FROM t2 JOIN v1 ON (x=a)
 WHERE b BETWEEN 10 AND 20;

```


 The view v1 cannot be [flattened](optoverview.html#flattening) because it is DISTINCT. It must
 instead be run as a subquery with the results being stored in a
 transient table, then the join is performed between t2 and the
 transient table. The push\-down optimization pushes down the
 "b BETWEEN 10 AND 20" term into the view. This makes the transient
 table smaller, and helps the subquery to run faster if there
 is an index on t1\.b. The resulting evaluation is like this:




```
SELECT x, y, b
  FROM t2
  JOIN (SELECT DISTINCT a, b FROM t1 WHERE b BETWEEN 10 AND 20)
 WHERE b BETWEEN 10 AND 20;

```


 The WHERE\-clause push\-down optimization cannot always be used. For example,
 if the subquery contains a LIMIT, then pushing down any part of
 the WHERE clause from the outer query could change the result of
 the inner query. There are other restrictions, explained in a
 comment in the source code on the pushDownWhereTerms() routine
 that implements this optimization.




 Do not confuse this optimization with the optimization by a similar name
 in MySQL. The MySQL push\-down optimization changes the order of evaluation
 of WHERE\-clause constraints such that those that can be evaluated using
 only the index and without having to find the corresponding table row are
 evaluated first, thus avoiding an unnecessary table row lookup if the
 constraint fails. For disambiguation, SQLite calls this the
 "MySQL push\-down optimization". SQLite does do the MySQL push\-down
 optimization too, in addition to the WHERE\-clause push\-down optimization.
 But the focus of this section is the WHERE\-clause push\-down optimization.




