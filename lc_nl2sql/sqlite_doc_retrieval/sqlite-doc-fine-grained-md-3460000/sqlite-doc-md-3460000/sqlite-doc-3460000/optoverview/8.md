# 5\. The LIKE Optimization



 A WHERE\-clause term that uses the [LIKE](lang_expr.html#like) or [GLOB](lang_expr.html#glob) operator
 can sometimes be used with an index to do a range search, 
 almost as if the LIKE or GLOB were an alternative to a [BETWEEN](lang_expr.html#between)
 operator.
 There are many conditions on this optimization:






1. The right\-hand side of the LIKE or GLOB must be either a string literal
 or a [parameter](lang_expr.html#varparam) bound to a string literal
 that does not begin with a wildcard character.
2. It must not be possible to make the LIKE or GLOB operator true by
 having a numeric value (instead of a string or blob) on the
 left\-hand side. This means that either:
	1. the left\-hand side of the LIKE or GLOB operator is the name
	 of an indexed column with [TEXT affinity](datatype3.html#affinity), or
	2. the right\-hand side pattern argument does not begin with a
	 minus sign ("\-") or a digit.
 This constraint arises from the fact that numbers do not sort in
 lexicographical order. For example: 9\<10 but '9'\>'10'.
3. The built\-in functions used to implement LIKE and GLOB must not
 have been overloaded using the [sqlite3\_create\_function()](c3ref/create_function.html) API.
4. For the GLOB operator, the column must be indexed using the 
 built\-in BINARY collating sequence.
5. For the LIKE operator, if [case\_sensitive\_like](pragma.html#pragma_case_sensitive_like) mode is enabled then
 the column must indexed using BINARY collating sequence, or if
 [case\_sensitive\_like](pragma.html#pragma_case_sensitive_like) mode is disabled then the column must indexed
 using built\-in NOCASE collating sequence.
6. If the ESCAPE option is used, the ESCAPE character must be ASCII,
 or a single\-byte character in UTF\-8\.



 The LIKE operator has two modes that can be set by a
 [pragma](pragma.html#pragma_case_sensitive_like). The
 default mode is for LIKE comparisons to be insensitive to differences
 of case for latin1 characters. Thus, by default, the following
 expression is true:




```
'a' LIKE 'A'

```


 If the case\_sensitive\_like pragma is enabled as follows:




```
PRAGMA case_sensitive_like=ON;

```


 Then the LIKE operator pays attention to case and the example above would
 evaluate to false. Note that case insensitivity only applies to
 latin1 characters \- basically the upper and lower case letters of English
 in the lower 127 byte codes of ASCII. International character sets
 are case sensitive in SQLite unless an application\-defined
 [collating sequence](datatype3.html#collation) and [like() SQL function](lang_corefunc.html#like) are provided that
 take non\-ASCII characters into account.
 If an application\-defined collating sequence and/or like() SQL
 function are provided, the LIKE optimization described here will never
 be taken.




 The LIKE operator is case insensitive by default because this is what
 the SQL standard requires. You can change the default behavior at
 compile time by using the [SQLITE\_CASE\_SENSITIVE\_LIKE](compile.html#case_sensitive_like) command\-line option
 to the compiler.




 The LIKE optimization might occur if the column named on the left of the
 operator is indexed using the built\-in BINARY collating sequence and
 case\_sensitive\_like is turned on. Or the optimization might occur if
 the column is indexed using the built\-in NOCASE collating sequence and the 
 case\_sensitive\_like mode is off. These are the only two combinations
 under which LIKE operators will be optimized.




 The GLOB operator is always case sensitive. The column on the left side
 of the GLOB operator must always use the built\-in BINARY collating sequence
 or no attempt will be made to optimize that operator with indexes.




 The LIKE optimization will only be attempted if
 the right\-hand side of the GLOB or LIKE operator is either
 literal string or a [parameter](lang_expr.html#varparam) that has been [bound](c3ref/bind_blob.html)
 to a string literal. The string literal must not
 begin with a wildcard; if the right\-hand side begins with a wildcard
 character then this optimization is not attempted. If the right\-hand side 
 is a [parameter](lang_expr.html#varparam) that is bound to a string, then this optimization is
 only attempted if the [prepared statement](c3ref/stmt.html) containing the expression
 was compiled with [sqlite3\_prepare\_v2()](c3ref/prepare.html) or [sqlite3\_prepare16\_v2()](c3ref/prepare.html).
 The LIKE optimization is not attempted if the
 right\-hand side is a [parameter](lang_expr.html#varparam) and the statement was prepared using
 [sqlite3\_prepare()](c3ref/prepare.html) or [sqlite3\_prepare16()](c3ref/prepare.html).




 Suppose the initial sequence of non\-wildcard characters on the right\-hand
 side of the LIKE or GLOB operator is *x*. We are using a single 
 character to denote this non\-wildcard prefix but the reader should
 understand that the prefix can consist of more than 1 character.
 Let *y* be the smallest string that is the same length as /x/ but which
 compares greater than *x*. For example, if *x* is
 'hello' then
 *y* would be 'hellp'.
 The LIKE and GLOB optimizations consist of adding two virtual terms
 like this:


> ```
> 
>   column >= x AND column < y
> 
> ```





 Under most circumstances, the original LIKE or GLOB operator is still
 tested against each input row even if the virtual terms are used to
 constrain an index. This is because we do not know what additional
 constraints may be imposed by characters to the right
 of the *x* prefix. However, if there is only a single
 global wildcard to the right of *x*, then the original LIKE or 
 GLOB test is disabled.
 In other words, if the pattern is like this:


> ```
> 
>   column LIKE x%
>   column GLOB x*
> 
> ```





 then the original LIKE or GLOB tests are disabled when the virtual
 terms constrain an index because in that case we know that all of the
 rows selected by the index will pass the LIKE or GLOB test.




 Note that when the right\-hand side of a LIKE or GLOB operator is
 a [parameter](lang_expr.html#varparam) and the statement is prepared using [sqlite3\_prepare\_v2()](c3ref/prepare.html)
 or [sqlite3\_prepare16\_v2()](c3ref/prepare.html) then the statement is automatically reparsed
 and recompiled on the first [sqlite3\_step()](c3ref/step.html) call of each run if the binding
 to the right\-hand side parameter has changed since the previous run.
 This reparse and recompile is essentially the same action that occurs
 following a schema change. The recompile is necessary so that the query
 planner can examine the new value bound to the right\-hand side of the
 LIKE or GLOB operator and determine whether or not to employ the
 optimization described above.




