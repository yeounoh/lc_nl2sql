## 2\.2\. Lemon Customizations Especially For SQLite


One of the advantages of hosting code generator tools as part of
the project is that the tools can be optimized to serve specific needs of
the overall project. Lemon has benefited from this effect. Over the years,
the Lemon parser generator has been extended and enhanced to provide
new capabilities and improved performance to SQLite. A few of the
specific enhancements to Lemon that are specifically designed for use
by SQLite include:



* Lemon has the concept of a "fallback" token.
The SQL language contains a large number of keywords and these keywords
have the potential to collide with identifier names.
Lemon has the ability to designate some keywords as being able to
"fallback" to an identifier. If the keyword appears in the input token
stream in a context that would otherwise be a syntax error, the token
is automatically transformed into its fallback before the syntax error
is raised. This feature allows the parser to be very forgiving of
reserved words used as identifiers, which is a problem that comes up
frequently in the SQL language.
* In support of the [100% MC/DC testing](testing.html#mcdc) goal for SQLite, 
the parser code generated by Lemon has no unreachable branches,
and contains extra (compile\-time selected) instrumentation useful
for measuring test coverage.
* Lemon supports conditional compilation of grammar file rules, so that
a different parser can be generated depending on compile\-time options.
* As a performance optimization, reduce actions in the Lemon input grammar
are allowed to contain comments of the form "/\*A\-overwrites\-Z\*/" to indicate
that the semantic value "A" on the right\-hand side of the rule is allowed
to directly overwrite the semantic value "Z" on the left\-hand side.
This simple optimization reduces the number of stack operations in the
push\-down automaton used to parse the input grammar, and thus improve
performance of the parser. It also makes the generated code a little smaller.


The parsing of SQL statements is a significant consumer of CPU cycles 
in any SQL database engine. On\-going efforts to optimize SQLite have caused
the developers to spend a lot of time tweaking Lemon to generate faster
parsers. These efforts have benefited all users of the Lemon parser generator,
not just SQLite. But if Lemon had been a separately maintained tool, it
would have been more difficult to make coordinated changes to both SQLite
and Lemon, and as a result not as much optimization would have been
accomplished. Hence, the fact that the parser generator tool is included
in the source tree for SQLite has turned out to be a net benefit for both
the tool itself and for SQLite.



