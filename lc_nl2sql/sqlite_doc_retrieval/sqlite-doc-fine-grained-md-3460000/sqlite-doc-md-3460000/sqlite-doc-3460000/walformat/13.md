## 2\.3\. Locking Matrix


Access is coordinated in WAL mode using both the legacy DELETE\-mode
locks controlled by the xLock and xUnlock methods of the [sqlite3\_io\_methods](c3ref/io_methods.html)
object and the WAL locks controlled by the xShmLock method of the
[sqlite3\_io\_methods](c3ref/io_methods.html) object.



Conceptually, there is just a single DELETE\-mode lock. The DELETE\-mode
lock for a single database connection can be in exactly one of the
following states:


1. SQLITE\_LOCK\_NONE (unlocked)
2. SQLITE\_LOCK\_SHARED (reading)
3. SQLITE\_LOCK\_RESERVED (reading, waiting to write)
4. SQLITE\_LOCK\_PENDING (new readers blocked, waiting to write)
5. SQLITE\_LOCK\_EXCLUSIVE (writing)


The DELETE\-mode locks are stored on the [lock\-byte page](fileformat2.html#lockbyte) of the
main database file.
Only SQLITE\_LOCK\_SHARED and SQLITE\_LOCK\_EXCLUSIVE are factors for WAL\-mode
databases.
The other locking states are used in rollback\-mode, but not in WAL\-mode.



The [WAL\-mode locks](walformat.html#locks) are described above.



