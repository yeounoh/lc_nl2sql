




Generate A Changeset From A Session Object




[![SQLite](../images/sqlite370_banner.gif)](../index.html)


Small. Fast. Reliable.  
Choose any three.


* [Home](../index.html)* [Menu](javascript:void(0))* [About](../about.html)* [Documentation](../docs.html)* [Download](../download.html)* [License](../copyright.html)* [Support](../support.html)* [Purchase](../prosupport.html)* [Search](javascript:void(0))




* [About](../about.html)* [Documentation](../docs.html)* [Download](../download.html)* [Support](../support.html)* [Purchase](../prosupport.html)






Search Documentation
Search Changelog







[## Session Module C Interface](../session/intro.html)## Generate A Changeset From A Session Object


> ```
> int sqlite3session_changeset(
>   sqlite3_session *pSession,      /* Session object */
>   int *pnChangeset,               /* OUT: Size of buffer at *ppChangeset */
>   void **ppChangeset              /* OUT: Buffer containing changeset */
> );
> 
> ```


Obtain a changeset containing changes to the tables attached to the 
session object passed as the first argument. If successful, 
set \*ppChangeset to point to a buffer containing the changeset 
and \*pnChangeset to the size of the changeset in bytes before returning
SQLITE\_OK. If an error occurs, set both \*ppChangeset and \*pnChangeset to
zero and return an SQLite error code.


A changeset consists of zero or more INSERT, UPDATE and/or DELETE changes,
each representing a change to a single row of an attached table. An INSERT
change contains the values of each field of a new database row. A DELETE
contains the original values of each field of a deleted database row. An
UPDATE change contains the original values of each field of an updated
database row along with the updated values for each updated non\-primary\-key
column. It is not possible for an UPDATE change to represent a change that
modifies the values of primary key columns. If such a change is made, it
is represented in a changeset as a DELETE followed by an INSERT.


Changes are not recorded for rows that have NULL values stored in one or 
more of their PRIMARY KEY columns. If such a row is inserted or deleted,
no corresponding change is present in the changesets returned by this
function. If an existing row with one or more NULL values stored in
PRIMARY KEY columns is updated so that all PRIMARY KEY columns are non\-NULL,
only an INSERT is appears in the changeset. Similarly, if an existing row
with non\-NULL PRIMARY KEY values is updated so that one or more of its
PRIMARY KEY columns are set to NULL, the resulting changeset contains a
DELETE change only.


The contents of a changeset may be traversed using an iterator created
using the [sqlite3changeset\_start()](../session/sqlite3changeset_start.html) API. A changeset may be applied to
a database with a compatible schema using the [sqlite3changeset\_apply()](../session/sqlite3changeset_apply.html)
API.


Within a changeset generated by this function, all changes related to a
single table are grouped together. In other words, when iterating through
a changeset or when applying a changeset to a database, all changes related
to a single table are processed before moving on to the next table. Tables
are sorted in the same order in which they were attached (or auto\-attached)
to the sqlite3\_session object. The order in which the changes related to
a single table are stored is undefined.


Following a successful call to this function, it is the responsibility of
the caller to eventually free the buffer that \*ppChangeset points to using
[sqlite3\_free()](../c3ref/free.html).


