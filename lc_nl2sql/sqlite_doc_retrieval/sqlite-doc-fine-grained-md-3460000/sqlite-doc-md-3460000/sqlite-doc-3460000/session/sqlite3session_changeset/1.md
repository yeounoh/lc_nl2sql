### Changeset Generation




Once a table has been attached to a session object, the session object
records the primary key values of all new rows inserted into the table.
It also records the original primary key and other column values of any
deleted or updated rows. For each unique primary key value, data is only
recorded once \- the first time a row with said primary key is inserted,
updated or deleted in the lifetime of the session.


There is one exception to the previous paragraph: when a row is inserted,
updated or deleted, if one or more of its primary key columns contain a
NULL value, no record of the change is made.


The session object therefore accumulates two types of records \- those
that consist of primary key values only (created when the user inserts
a new record) and those that consist of the primary key values and the
original values of other table columns (created when the users deletes
or updates a record).


When this function is called, the requested changeset is created using
both the accumulated records and the current contents of the database
file. Specifically:


* For each record generated by an insert, the database is queried
 for a row with a matching primary key. If one is found, an INSERT
 change is added to the changeset. If no such row is found, no change 
 is added to the changeset.



 - For each record generated by an update or delete, the database is 
 queried for a row with a matching primary key. If such a row is
 found and one or more of the non\-primary key fields have been
 modified from their original values, an UPDATE change is added to 
 the changeset. Or, if no such row is found in the table, a DELETE 
 change is added to the changeset. If there is a row with a matching
 primary key in the database, but all fields contain their original
 values, no change is added to the changeset.



This means, amongst other things, that if a row is inserted and then later
deleted while a session object is active, neither the insert nor the delete
will be present in the changeset. Or if a row is deleted and then later a 
row with the same primary key values inserted while a session object is
active, the resulting changeset will contain an UPDATE change instead of
a DELETE and an INSERT.


When a session object is disabled (see the [sqlite3session\_enable()](../session/sqlite3session_enable.html) API),
it does not accumulate records when rows are inserted, updated or deleted.
This may appear to have some counter\-intuitive effects if a single row
is written to more than once during a session. For example, if a row
is inserted while a session object is enabled, then later deleted while 
the same session object is disabled, no INSERT record will appear in the
changeset, even though the delete took place while the session was disabled.
Or, if one field of a row is updated while a session is disabled, and 
another field of the same row is updated while the session is enabled, the
resulting changeset will contain an UPDATE change that updates both fields.


See also lists of
 [Objects](../session/objlist.html),
 [Constants](../session/constlist.html), and
 [Functions](../session/funclist.html).


