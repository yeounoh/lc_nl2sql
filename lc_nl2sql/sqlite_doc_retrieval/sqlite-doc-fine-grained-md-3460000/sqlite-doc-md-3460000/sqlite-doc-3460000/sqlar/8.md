# 5\. Managing SQLite Archives From Application Code



Applications can easily read or write SQLite Archives by linking against
SQLite and including the
[ext/misc/sqlar.c](https://sqlite.org/src/file/ext/misc/sqlar.c) extension
to handle the compression and decompression. The sqlar.c extension
creates two new SQL functions.




**sqlar\_compress(X)**

The sqlar\_compress(X) function attempts to compress a copy of the
blob X using the [Default](https://zlib.net/) algorithm and returns the
result as a blob. If the input X is not a compressible blob, then
a copy of X is returned. This routine is used when inserting content
into an SQLite Archive.


**sqlar\_uncompress(Y,SZ)**

The sqlar\_uncompress(Y,SZ) function will undo the compression accomplished
by sqlar\_compress(X). The Y parameter is the compressed content (the output
from a prior call to sqlar\_compress()) and SZ is the original uncompressed
size of the input X that generated Y. If SZ is less than or equal to the
size of Y, that indicates that no compression occurred, and so
sqlar\_uncompress(Y,SZ) returns a copy of Y. Otherwise, sqlar\_uncompress(Y,SZ)
runs the Inflate algorithm on Y to uncompress it and restore it to its
original form and returns the uncompressed content.
This routine is used when extracting content from an SQLite Archive.




Using the two routines above, it is simple for applications to insert
new records into or extract existing records from an SQLite Archive.
Insert a new into an SQLite Archive using code like this:




```
INSERT INTO sqlar(name,mode,mtime,sz,data)
 VALUES ($name,$mode,strftime('%s',$mtime),
         length($content),sqlar_compress($content));

```


Extract an entry from the SQLite Archive using code like this:




```
SELECT name, mode, datetime(mtime,'unixepoch'), sqlar_uncompress(data,sz)
  FROM sqlar
 WHERE ...;

```


The code above is for the general case. For the special case of an
SQLite Archive that only stores uncompressed or uncompressible content
(this might come up, for example, in an SQLite Archive that stores only
JPEG, GIF, and/or PNG images) then the content can be inserted into
and extracted from the database without using the sqlar\_compress()
and sqlar\_uncompress() functions, and the sqlar.c extension is not
required.



