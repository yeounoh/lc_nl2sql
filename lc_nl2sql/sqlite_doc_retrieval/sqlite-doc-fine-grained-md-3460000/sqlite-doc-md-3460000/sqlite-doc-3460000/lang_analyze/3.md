## 2\.1\. Periodically run "PRAGMA optimize"


The [PRAGMA optimize](pragma.html#pragma_optimize) command will automatically run ANALYZE when
needed. Suggested use:



1. Applications with short\-lived database connections should run
"PRAGMA optimize;" once, just prior to closing each database connection.
2. Applications that use long\-lived database connections should run
"PRAGMA optimize\=0x10002;" when the connection is first opened, and then
also run "PRAGMA optimize;" periodically, perhaps once per day, or more if
the database is evolving rapidly.
3. All applications should run "PRAGMA optimize;" after a schema change,
especially after one or more [CREATE INDEX](lang_createindex.html) statements.





The [PRAGMA optimize](pragma.html#pragma_optimize) command is usually a no\-op but it will occasionally
run one or more ANALYZE subcommands on individual tables of the database
if doing so will be useful to the query planner.
Since SQLite version 3\.46\.0 (2024\-05\-23\), the "PRAGMA optimize" command
automatically limits the scope of ANALYZE subcommands so that
the overall "PRAGMA optimize" command completes quickly even on enormous
databases. There is no need to use [PRAGMA analysis\_limit](pragma.html#pragma_analysis_limit). This is the
recommended way of running ANALYZE moving forward.



The [PRAGMA optimize](pragma.html#pragma_optimize) command will normally only consider running ANALYZE on
tables that have been previously queried by the same database connection or
that do not have entries in the [sqlite\_stat1](fileformat2.html#stat1tab) table.
However, if the 0x10000 bit is added to the argument, PRAGMA optimize will
examine all tables to see if they can benefit from ANALYZE, not just those
that have been recently queried.
There is no query history when a database connection first opens, and
that is why adding the 0x10000 bit is recommended when running PRAGMA optimize
on a fresh database connection.



See the [Automatically Running ANALYZE](lang_analyze.html#autoanalyze) and
[Approximate ANALYZE For Large Databases](lang_analyze.html#approx) sections below for additional
information.




