# 4\. Automatically Running ANALYZE


The [PRAGMA optimize](pragma.html#pragma_optimize) command will automatically run ANALYZE on individual
tables on an as\-needed basis. The recommended practice is for applications
to invoke the [PRAGMA optimize](pragma.html#pragma_optimize) statement just before closing each database
connection. Or, if the application keeps a single database connection open
for a long time, then it should run "PRAGMA optimize\=0x10002" when the
connection is first opened and run "PRAGMA optimize;" periodically thereafter,
perhaps once per day or even once per hour.


Each SQLite [database connection](c3ref/sqlite3.html) records cases when the query planner would
benefit from having accurate results of ANALYZE at hand. These records
are held in memory and accumulate over the life of a database connection.
The [PRAGMA optimize](pragma.html#pragma_optimize) command looks at those records and runs ANALYZE on only
those tables for which new or updated ANALYZE data seems likely to be useful.
In most cases [PRAGMA optimize](pragma.html#pragma_optimize) will not run ANALYZE, but it will occasionally
do so either for tables that have never before been analyzed, or for tables
that have grown significantly since they were last analyzed.


Since the actions of [PRAGMA optimize](pragma.html#pragma_optimize) are determined to some extent by
prior queries that have been evaluated on the same database connection, it
is recommended that [PRAGMA optimize](pragma.html#pragma_optimize) be deferred until the database connection
is closing and has thus had an opportunity to accumulate as much usage information
as possible. It is also reasonable to set a timer to run [PRAGMA optimize](pragma.html#pragma_optimize)
every few hours, or every few days, for database connections that stay open
for a long time. When running [PRAGMA optimize](pragma.html#pragma_optimize) immediately after a
database connection is opened, one can add the 0x10000 bit to the bitmask
argument (thus making the command read "PRAGMA optimize\=0x10002") which
causes all tables to be examined, even tables that have not been
queried during the current connection.


The [PRAGMA optimize](pragma.html#pragma_optimize) command was first introduced with 
SQLite 3\.18\.0 (2017\-03\-28\) and is a no\-op for all prior releases
of SQLite. The [PRAGMA optimize](pragma.html#pragma_optimize) command was significantly enhanced
in SQLite 3\.46\.0 (2024\-05\-23\) and the advice given in this
documentation is based on those enhancements. Applications that
use earlier versions of SQLite should consult the corresponding
documentation for better advice on the best ways to use PRAGMA optimize.



