# 5\. Approximate ANALYZE For Large Databases


By default, ANALYZE does a full scan of every index. This can be slow for
large databases. So beginning with SQLite version 3\.32\.0 (2020\-05\-22\), the
[PRAGMA analysis\_limit](pragma.html#pragma_analysis_limit) command can be used to limit the amount of
scanning performed by ANALYZE, and thus help ANALYZE to run faster,
even on very large database files. We call this running an
"approximate ANALYZE".



The recommended usage pattern for the [analysis\_limit](pragma.html#pragma_analysis_limit) pragma is
like this:




```
PRAGMA analysis_limit=1000;

```

This pragma tells the ANALYZE command to start a full scan
of the index as it normally would. But when the number of rows visited
reaches 1000 (or whatever other limit is specified by the pragma), the
ANALYZE command will begin taking actions to stop the scan. If
the left\-most column of the index has changed at least once during the
previous 1000 steps, then the analysis stops immediately. But if the
left\-most column has always been the same, then ANALYZE skips ahead to
the first entry with a different left\-most column and reads an additional
1000 rows before terminating.



The details of the effects of the analysis limit described in the previous
paragraph are subject to change in future versions of SQLite. But the
core idea will remain the same. An analysis limit of N will strive to
limit the number of rows visited in each index to approximately N.



Values of N between 100 and 1000 are recommended.
Or, to disable the analysis limit, causing ANALYZE to do a
complete scan of each index, set the analysis limit to 0\. The default
value for the analysis limit is 0 for backwards compatibility.



The values placed in the sqlite\_stat1 table by an approximate ANALYZE
are not exactly the same as what would be computed by an unrestricted 
analysis. But they are usually close enough. The index statistics in
the sqlite\_stat1 table are approximations in any case, so the fact that
the results of an approximate ANALYZE are slightly different from
a traditional full scan ANALYZE has little practical impact. It is
possible to construct a pathological case where an approximate ANALYZE
is noticeably inferior to a full\-scan ANALYZE, but such cases are rare in
real\-world problems.



A good rule of thumb seems to be to always set "PRAGMA analysis\_limit\=N"
for N between 100 and 1000 prior to running either "ANALYZE". It used
to be that this was also recommended prior to running
"[PRAGMA optimize](pragma.html#pragma_optimize)", but since version 3\.46\.0 (2024\-05\-23\) that
happens automatically. The results are not quite as precise when using
PRAGMA analysis\_limit, but they are precise enough, and the fact that
the results are computed so much faster means that developers are more
likely to compute them. An approximate ANALYZE is better than not
running ANALYZE at all.



