## 2\.2\. Fixed results of ANALYZE


Running ANALYZE can cause SQLite to choose different query plans
for subsequent queries. This is almost always a positive thing, as the
query plans chosen after ANALYZE will in nearly every case be better than
the query plans picked before ANALYZE. That is the whole point of ANALYZE.
But there can be no proof of running ANALYZE will always be beneficial.
One can construct pathological cases where running
ANALYZE could make some subsequent queries run slower.



Some developers prefer that once the design of an application is frozen,
SQLite will always pick the same query plans as it did during
development and testing.
Then if a millions of copies of the application are shipped to customers,
the developers are assured that all of those millions of copies are running
the same query plans regardless of what data the individual customers insert
into their particular databases. This can help in reproducing complaints
of performance problems coming back from the field.



To achieve this objection, never run a full ANALYZE nor the
"PRAGMA optimize" command in the application.
Rather, only run ANALYZE during development, manually using the
[command\-line interface](cli.html) or similar, on a test database 
that is similar in size and content to live databases. Then capture
the result of this one\-time ANALYZE using a script like the
following:




```
.mode list
SELECT 
  'ANALYZE sqlite_schema;' ||
  'DELETE FROM sqlite_stat1;' ||
  'INSERT INTO sqlite_stat1(tbl,idx,stat)VALUES' ||
  (SELECT group_concat(format('(%Q,%Q,%Q)',tbl,idx,stat),',')
    FROM sqlite_stat1) ||
  ';ANALYZE sqlite_schema;';

```

When creating a new instance of the database in deployed instances of
the application, or perhaps every time the application is started up in
the case of long\-running applications, run the commands generated by
script above. This will populate the [sqlite\_stat1](fileformat2.html#stat1tab) table exactly as
it was during development and testing and ensure that the query plans
selected in the field are same has those selected during testing in the
lab. Maybe copy/paste the string generated by the script above into
a static string constant named "zStat1Init" and then invoke:




```
sqlite3_exec(db, zStat1Init, 0, 0, 0);

```

Perhaps also add "BEGIN;" at the start of the string constant and
"COMMIT;" at the end, depending on the context in which the script is run.



See the [query planner stability guarantee](queryplanner-ng.html#qpstab) for addition information.



