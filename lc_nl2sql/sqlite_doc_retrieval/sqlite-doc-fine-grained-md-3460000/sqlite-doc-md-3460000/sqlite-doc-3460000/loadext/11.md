# 5\. Persistent Loadable Extensions


The default behavior for a loadable extension is that it is unloaded
from process memory when the database connection that originally invoked
[sqlite3\_load\_extension()](c3ref/load_extension.html) closes. (In other words, the xDlClose method
of the [sqlite3\_vfs](c3ref/vfs.html) object is called for all extensions when a database
connection closes.) However, if the initialization procedure returns
[SQLITE\_OK\_LOAD\_PERMANENTLY](rescode.html#ok_load_permanently) instead of SQLITE\_OK, then the extension will
not be unloaded (xDlClose will not be invoked) and the extension will remain
in process memory indefinitely. The SQLITE\_OK\_LOAD\_PERMANENTLY return
value is useful for extensions that want to register new [VFSes](vfs.html).



To clarify: an extension for which the initialization function returns
SQLITE\_OK\_LOAD\_PERMANENTLY continues to exist in memory after the database
connection closes. However, the extension is *not* automatically
registered with subsequent database connections. This makes it possible
to load extensions that implement new [VFSes](vfs.html).
To persistently load and register an extension that implements new SQL
functions, collating sequences, and/or virtual tables, such that those
added capabilities are available to all subsequent database connections,
then the initialization routine should also invoke [sqlite3\_auto\_extension()](c3ref/auto_extension.html)
on a subfunction that will register those services.



The [vfsstat.c](https://sqlite.org/src/file/ext/misc/vfsstat.c) extension
show an example of a loadable extension that persistently registers both
a new VFS and a new virtual table. The
[sqlite3\_vfsstat\_init()](https://sqlite.org/src/info/77b5b4235c9f7f11?ln=801-819)
initialization routine in that extension is called only once, when the
extension is first loaded. It registers the new "vfslog" VFS just that
one time, and it returns SQLITE\_OK\_LOAD\_PERMANENTLY so that the code used
to implement the "vfslog" VFS will remain in memory. The initialization routine
also invokes [sqlite3\_auto\_extension()](c3ref/auto_extension.html) on a pointer to the "vstatRegister()"
function so that all subsequent database connections will invoke the
"vstatRegister()" function as they start up, and hence register the
"vfsstat" virtual table.




