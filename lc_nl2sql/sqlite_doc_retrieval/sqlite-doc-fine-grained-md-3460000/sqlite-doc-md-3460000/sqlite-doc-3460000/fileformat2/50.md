## 4\.6\. WAL\-Index Format


Conceptually, the wal\-index is shared memory, though the current
VFS implementations use a memory\-mapped file for operating\-system
portability. The memory\-mapped
file is in the same directory as the database and has the same name
as the database with a "\-shm" suffix appended. Because
the wal\-index is shared memory, SQLite does not support 
[journal\_mode\=WAL](pragma.html#pragma_journal_mode) 
on a network filesystem when clients are on different machines, as
all clients of the database must be able to share the same memory.


The purpose of the wal\-index is to answer this question quickly:



> *Given a page number P and a maximum WAL frame index M,
> return the largest WAL frame index for page P that does not exceed M, 
> or return NULL if there are no frames for page P that do not exceed M.*


The *M* value in the previous paragraph is the "mxFrame" value
defined in [section 4\.4](fileformat2.html#walread) that is read at the start 
of a transaction and which defines the maximum frame from the WAL that 
the reader will use.


The wal\-index is transient. After a crash, the wal\-index is
reconstructed from the original WAL file. The VFS is required
to either truncate or zero the header of the wal\-index when the last
connection to it closes. Because the wal\-index is transient, it can
use an architecture\-specific format; it does not have to be cross\-platform.
Hence, unlike the database and WAL file formats which store all values
as big endian, the wal\-index stores multi\-byte values in the native
byte order of the host computer.


This document is concerned with the persistent state of the database
file, and since the wal\-index is a transient structure, no further 
information about the format of the wal\-index will be provided here.
Additional details on the format of the wal\-index are contained in
the separate [WAL\-index File Format](walformat.html#walidxfmt) document.


*This page last modified on [2024\-04\-20 09:25:12](https://sqlite.org/docsrc/honeypot) UTC* 


