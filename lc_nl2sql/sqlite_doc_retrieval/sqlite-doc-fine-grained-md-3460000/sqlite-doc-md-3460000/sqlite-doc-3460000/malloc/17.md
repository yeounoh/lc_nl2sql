### 3\.3\.1\. Two\-Size Lookaside



Beginning with SQLite version 3\.31\.0 (2020\-01\-22\),
lookaside supports two memory pools, each with a different size
slot. The small\-slot pool uses 128\-byte slots and the large\-slot
pool uses whatever size is specified by [SQLITE\_DBCONFIG\_LOOKASIDE](c3ref/c_dbconfig_defensive.html#sqlitedbconfiglookaside)
(defaulting to 1200 bytes). Splitting the pool in two like this
allows memory allocations to be covered by lookaside more often
while at the same time reducing per\-database\-connection heap usage
from 120KB down to 48KB.




Configuration continues to use the SQLITE\_DBCONFIG\_LOOKASIDE or
SQLITE\_CONFIG\_LOOKASIDE configuration options, as described above,
with parameters "sz" and "cnt". The total heap space used for
lookaside continues to be sz\*cnt bytes. But the space is allocated
between the small\-slot lookaside and big\-slot lookaside, with
preference given to small\-slot lookaside. The total number of
slots will usually exceed "cnt", since "sz" is typically much
larger than the small\-slot size of 128 bytes.




The default lookaside configuration has changed from 100 slots
of 1200 bytes each (120KB) to be 40 slots of 1200 bytes each
(48KB). This space ends up being allocated as 93 slots of
128 bytes each and 30 slots of 1200 bytes each. So more lookaside
slots are available but much less heap space is used.




The default lookaside configuration, the size of the small\-slots,
and the details of how heap space is allocated between small\-slots
and big\-slots, are all subject to change from one release to the
next.





