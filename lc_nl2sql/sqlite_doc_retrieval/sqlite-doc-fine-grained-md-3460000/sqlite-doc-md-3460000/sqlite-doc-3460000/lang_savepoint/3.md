# 3\. Transaction Nesting Rules


The last transaction started will be the first
transaction committed or rolled back.


The [BEGIN](lang_transaction.html) command only works if the transaction stack is empty, or
in other words if there are no pending transactions. If the transaction
stack is not empty when the [BEGIN](lang_transaction.html) command is invoked, then the command
fails with an error.


The [COMMIT](lang_transaction.html) command commits all outstanding transactions and leaves
the transaction stack empty.


The RELEASE command starts with the most recent addition to the
transaction stack and releases savepoints backwards 
in time until it releases a savepoint with a matching savepoint\-name.
Prior savepoints, even savepoints with matching savepoint\-names, are
unchanged.
If the RELEASE command causes the
transaction stack to become empty (if the RELEASE command releases the
outermost transaction from the stack) then the transaction commits.


The [ROLLBACK](lang_transaction.html) command without a TO clause rolls backs all transactions
and leaves the transaction stack empty.


The ROLLBACK command with a TO clause rolls back transactions going
backwards in time back to the most recent SAVEPOINT with a matching name.
The SAVEPOINT with the matching name remains on the transaction stack,
but all database changes that occurred after that SAVEPOINT was created
are rolled back. If the savepoint\-name in a ROLLBACK TO command does not
match any SAVEPOINT on the stack, then the ROLLBACK command fails with an
error and leaves the state of the database unchanged.


*This page last modified on [2022\-01\-08 05:02:57](https://sqlite.org/docsrc/honeypot) UTC* 


