# Powersafe Overwrite


"Powersafe overwrite" is a term used by the SQLite team to describe
a behavior of some filesystems and disk\-controllers related to
data preservation during a power loss. Powersafe overwrite
is a boolean property: either the storage system has it or it does not.

We say that a system has the powersafe overwrite property if the following
statement is true:


> **When an application writes a range of bytes in a file, no
>  bytes outside of that range will change, even if the write occurs
>  just before a crash or power failure.**


The powersafe overwrite property says nothing about the state of the
bytes that were written. Those bytes might contain their old values,
their new values, random values, or some combination of these. The powersafe
overwrite property merely states that writes cannot change bytes outside
of the range of bytes written.

In other words, powersafe overwrite means that there is no "collateral
damage" when a power loss occurs while writing. Only those bytes actually
being written might be damaged.

In practical terms, what the powersafe write property means is that when
the disk controller detects an impending power loss, it finishes writing
whatever sector it is working on prior to parking the heads. It means that
individual sector writes will complete once started, even if
there is a power loss.

Consider what would happen if disk sector writes are interrupted
by a power loss. If an application writes two or three bytes in the middle
of some file, the operating system will implement this by first reading
the entire sector containing those bytes, making the change to the
sector in memory, then writing the entire sector back to the disk. If a power
loss occurs during the writeback and the sector was not completely written,
then on the next read after reboot, error correcting codes
in the sector will probably detect irreparable damage and the disk 
controller will read out the sector as all zeros or all ones. Thus
values will have changed outside of the range of the two or three bytes 
that were written at the application level \- a violation of the powersafe
overwrite property.

