## 2\.2\. Write Performance Measurements



Writes are slower.
On all systems, using both direct I/O and SQLite, write performance is
between 5 and 15 times slower than reads.




Write performance measurements were made by replacing (overwriting)
an entire blob with a different blob. All of the blobs in these
experiment are random and incompressible. Because writes are so much
slower than reads, only 10,000 of the 100,000 blobs in the database
are replaced. The blobs to be replaced are selected at random and
are in no particular order.




The direct\-to\-disk writes are accomplished using fopen()/fwrite()/fclose().
By default, and in all the results shown below, the OS filesystem buffers are
never flushed to persistent storage using fsync() or
FlushFileBuffers(). In other words, there is no attempt to make the
direct\-to\-disk writes transactional or power\-safe.
We found that invoking fsync() or FlushFileBuffers() on each file
written causes direct\-to\-disk storage
to be about 10 times or more slower than writes to SQLite.




The next chart compares SQLite database updates in [WAL mode](wal.html)
against raw direct\-to\-disk overwrites of separate files on disk.
The [PRAGMA synchronous](pragma.html#pragma_synchronous) setting is NORMAL.
All database writes are in a single transaction.
The timer for the database writes is stopped after the transaction
commits, but before a [checkpoint](wal.html#ckpt) is run.
Note that the SQLite writes, unlike the direct\-to\-disk writes,
are [transactional](transactional.html) and [power\-safe](transactional.html), though because the synchronous
setting is NORMAL instead of FULL, the transactions are not durable.





![](images/faster-write-safe.jpg)

  

Chart 4: SQLite write latency relative to direct filesystem writes.  

10K blobs, avg size 10KB, random order,  

WAL mode with synchronous NORMAL,  

exclusive of checkpoint time


The android performance numbers for the write experiments are omitted
because the performance tests on the Galaxy S3 are so random. Two
consecutive runs of the exact same experiment would give wildly different
times. And, to be fair, the performance of SQLite on android is slightly
slower than writing directly to disk.




The next chart shows the performance of SQLite versus direct\-to\-disk
when transactions are disabled ([PRAGMA journal\_mode\=OFF](pragma.html#pragma_journal_mode))
and [PRAGMA synchronous](pragma.html#pragma_synchronous) is set to OFF. These settings put SQLite on an
equal footing with direct\-to\-disk writes, which is to say they make the
data prone to corruption due to system crashes and power failures.





![](images/faster-write-unsafe.jpg)

  

Chart 5: SQLite write latency relative to direct filesystem writes.  

10K blobs, avg size 10KB, random order,  

journaling disabled, synchronous OFF.


In all of the write tests, it is important to disable anti\-virus software
prior to running the direct\-to\-disk performance tests. We found that
anti\-virus software slows down direct\-to\-disk by an order of magnitude
whereas it impacts SQLite writes very little. This is probably due to the
fact that direct\-to\-disk changes thousands of separate files which all need
to be checked by anti\-virus, whereas SQLite writes only changes the single
database file.



