# 17\. Index Recommendations (SQLite Expert)


**Note: This command is experimental. It may be removed or the
interface modified in incompatible ways at some point in the future.**

For most non\-trivial SQL databases, the key to performance is creating
the right SQL indexes. In this context "the right SQL indexes" means those
that cause the queries that an application needs to optimize run fast. The
".expert" command can assist with this by proposing indexes that might
assist with specific queries, were they present in the database.



The ".expert" command is issued first, followed by the SQL query
on a separate line. For example, consider the following session:




```
sqlite> CREATE TABLE x1(a, b, c);                  -- Create table in database 
sqlite> .expert
sqlite> SELECT * FROM x1 WHERE a=? AND b>?;        -- Analyze this SELECT 
CREATE INDEX x1_idx_000123a7 ON x1(a, b);

0|0|0|SEARCH TABLE x1 USING INDEX x1_idx_000123a7 (a=? AND b>?)

sqlite> CREATE INDEX x1ab ON x1(a, b);             -- Create the recommended index 
sqlite> .expert
sqlite> SELECT * FROM x1 WHERE a=? AND b>?;        -- Re-analyze the same SELECT 
(no new indexes)

0|0|0|SEARCH TABLE x1 USING INDEX x1ab (a=? AND b>?)

```

In the above, the user creates the database schema (a single table \- "x1"),
and then uses the ".expert" command to analyze a query, in this case
"SELECT \* FROM x1 WHERE a\=? AND b\>?". The shell tool recommends that the
user create a new index (index "x1\_idx\_000123a7") and outputs the plan
that the query would use in [EXPLAIN QUERY PLAN](eqp.html) format. The user then creates
an index with an equivalent schema and runs the analysis on the same query
again. This time the shell tool does not recommend any new indexes, and
outputs the plan that SQLite will use for the query given the existing
indexes.



The ".expert" command accepts the following options:





| Option | Purpose |
| --- | --- |
| ‑‑verbose | If present, output a more verbose report for each query analyzed. |
| ‑‑sample PERCENT | This parameter defaults to 0, causing the ".expert" command to  recommend indexes based on the query and database schema alone.  This is similar to the way the [SQLite query planner](optoverview.html) selects  indexes for queries if the user has not run the [ANALYZE](lang_analyze.html) command  on the database to generate data distribution statistics.    If this option is passed a non\-zero argument, the ".expert" command  generates similar data distribution statistics for all indexes  considered based on PERCENT percent of the rows currently stored in  each database table. For databases with unusual data distributions,  this may lead to better index recommendations, particularly if the  application intends to run ANALYZE.    For small databases and modern CPUs, there is usually no reason not  to pass "\-\-sample 100". However, gathering data distribution  statistics can be expensive for large database tables. If the  operation is too slow, try passing a smaller value for the \-\-sample  option. |


The functionality described in this section may be integrated into other
applications or tools using the
[SQLite expert extension](https://www.sqlite.org/src/dir?ci=trunk&name=ext/expert) code.



A database schema which incorporate SQL custom functions made available
via the extension load mechanism may need special provision to work with
the .expert feature. Because the feature uses additional connections to
implement its functionality, those custom functions must be made available
to those additional connections. This can be done by means of the extension
load/usage options described at
[Automatically Load Statically Linked Extensions](c3ref/auto_extension.html)
and [Persistent Loadable Extensions](loadext.html#persist).




