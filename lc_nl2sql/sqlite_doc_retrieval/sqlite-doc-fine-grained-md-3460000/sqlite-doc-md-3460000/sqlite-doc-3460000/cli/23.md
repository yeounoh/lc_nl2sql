# 11\. Recover Data From a Corrupted Database


Like the ".dump" command, ".recover" attempts to convert the entire
contents of a database file to text. The difference is that instead of
reading data using the normal SQL database interface, ".recover"
attempts to reassemble the database based on data extracted directly from
as many database pages as possible. If the database is corrupt, ".recover"
is usually able to recover data from all uncorrupted parts of the database,
whereas ".dump" stops when the first sign of corruption is encountered.



If the ".recover" command recovers one or more rows that it cannot
attribute to any database table, the output script creates a "lost\_and\_found"
table to store the orphaned rows. The schema of the lost\_and\_found
table is as follows:




```
CREATE TABLE lost_and_found(
    rootpgno INTEGER,             -- root page of tree pgno is a part of
    pgno INTEGER,                 -- page number row was found on
    nfield INTEGER,               -- number of fields in row
    id INTEGER,                   -- value of rowid field, or NULL
    c0, c1, c2, c3...             -- columns for fields of row
);

```

The "lost\_and\_found" table contains one row for each orphaned row recovered
from the database. Additionally, there is one row for each recovered index
entry that cannot be attributed to any SQL index. This is because, in an
SQLite database, the same format is used to store SQL index entries and
WITHOUT ROWID table entries.





| Column | Contents |
| --- | --- |
| rootpgno | Even though it may not be possible to attribute the  row to a specific database table, it may be part of a tree structure  within the database file. In this case, the root page number of that  tree structure is stored in this column. Or, if the page the row was  found on is not part of a tree structure, this column stores a copy of  the value in column "pgno" \- the page number of the page the row was  found on. In many, although not all, cases, all rows in the  lost\_and\_found table with the same value in this column belong to the  same table. |
| pgno | The page number of the page on which this row was found. |
| nfield | The number of fields in this row. |
| id | If the row comes from a WITHOUT ROWID table, this column  contains NULL. Otherwise, it contains the 64\-bit integer rowid value for  the row. |
| c0, c1, c2\... | The values for each column of the row  are stored in these columns. The ".recover" command creates the  lost\_and\_found table with as many columns as required by the longest  orphaned row. |


If the recovered database schema already contains a table named
"lost\_and\_found", the ".recover" command uses the name "lost\_and\_found0". If
the name "lost\_and\_found0" is also already taken, "lost\_and\_found1", and so
on. The default name "lost\_and\_found" may be overridden by invoking ".recover"
with the \-\-lost\-and\-found switch. For example, to have the output script call
the table "orphaned\_rows":




```
sqlite> .recover --lost-and-found orphaned_rows

```


