## 2\.2\. Transient Imposter Tables



Another (safer) approach to creating an imposter table is to add an
entry for the imposter table to SQLite's internal symbol table without
updating the "sqlite\_schema" table on disk.
That way, the imposter table exists in only a single database connection
and is automatically removed whenever the schema is reloaded.




Creation of a transient imposter table involves a special
[sqlite3\_test\_control()](c3ref/test_control.html) call. Unlike all other SQLite APIs,
[sqlite3\_test\_control()](c3ref/test_control.html) interface is subject to incompatible changes
from one release to the next, and so the mechanism described below
is not guaranteed to work in future releases of SQLite. The
SQLite developers do not consider this a problem because imposter
tables should not be used in applications. Imposter tables are for
analysis and testing use only.




To create a transient imposter table, first call sqlite3\_test\_control()
as follows:




```
sqlite3_test_control(SQLITE_TESTCTRL_IMPOSTER, db, "main", 1, tnum);

```


The "db" parameter is a pointer to the [database connection](c3ref/sqlite3.html).
The "main" argument is the name of the schema in which the imposter
table is to be created. The "1" argument enables the imposter table
mechanism. "tnum" is the root page of the index that the imposter
table should mirror.




After the sqlite3\_test\_control() call above, then run a [CREATE TABLE](lang_createtable.html)
statement the defines the imposter table.
With the imposter mechanism enabled, this CREATE TABLE statement does
not create a real table but instead merely adds an entry in SQLite's
internal symbol table. Note that the CREATE TABLE statement must
be in the correct format for the index. If the imposter table has the
wrong number of columns or is not a [WITHOUT ROWID](withoutrowid.html) table or is otherwise
incompatible with the index b\-tree, then [SQLITE\_CORRUPT](rescode.html#corrupt) errors will result
when the imposter table is used.




After running the CREATE TABLE statement, disable the imposter mechanism
as follows:




```
sqlite3_test_control(SQLITE_TESTCTRL_IMPOSTER, db, "main", 0, 0);

```


In other words, make the same sqlite3\_test\_control() call except change
the last two parameters to zero.




After the imposter table is loaded into SQLite's internal schema as
described above, the imposter table can be used as any other table.
But the imposter table will only be visible to the one database
connection that created it. No changes are made to the database file
on disk. And the imposter table will disappear the next time the schema 
is loaded.




