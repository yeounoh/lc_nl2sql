# 4\. Materialization Hints



The "AS MATERIALIZED" and "AS NOT MATERIALIZED" forms of a common table expression
are non\-standard SQL syntax copied from PostgreSQL. Using MATERIALIZED or
NOT MATERIALIZED after the AS keyword provides non\-binding hints to the query
planner about how the CTE should be implemented.




If the MATERIALIZED phrase is used, then select\-stmt will
be materialized into an ephemeral table that is held in memory or in a
temporary disk file. That ephemeral table will then be used in place of the
CTE table name whenever the CTE table name appears in the subsequent SQL.
Because the select\-stmt is evaluated immediately,
the opportunity to apply optimizations such as
[query flattening](optoverview.html#flattening) or the [push\-down optimization](optoverview.html#pushdown), is lost.
This loss of optimization is a feature, not a bug. Developers are able
to use the MATERIALIZED keyword as an "optimization fence" to more tightly
control the behavior of the SQLite query planner. SQLite copied the idea of
using MATERIALIZED as an optimization fence from PostgreSQL.




If the NOT MATERIALIZED phrase is used, then select\-stmt
is substituted as a subquery in place of every occurrence of the CTE
table name. Optimizations such as [flattening](optoverview.html#flattening) and
[push\-down](optoverview.html#pushdown) are then applied to the subquery as if
the subquery had by used in directly. In spite of its name, the NOT MATERIALIZED
phrase does not prohibit the use of materialization. The query planner
is still free to implement the subquery using materialization if
it feels that is the best solution. The true meaning of NOT MATERIALIZED
is closer to "TREAT LIKE ANY ORDINARY VIEW OR SUBQUERY". 




If neither hint is present, then SQLite is free to choose whatever
implementation strategy it thinks will work best. This is the recommended
approach. *Do not use the MATERIALIZED or NOT MATERIALIZED keywords on
a common table expression unless you have a compelling reason to do so.*



The MATERIALIZED and NOT MATERIALIZED hints are only available in
SQLite version 3\.35\.0 (2021\-03\-12\) and later.



