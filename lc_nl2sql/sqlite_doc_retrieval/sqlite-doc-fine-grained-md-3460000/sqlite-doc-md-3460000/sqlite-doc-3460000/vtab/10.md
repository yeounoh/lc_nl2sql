## 2\.1\. The xCreate Method



```
int (*xCreate)(sqlite3 *db, void *pAux,
             int argc, char *const*argv,
             sqlite3_vtab **ppVTab,
             char **pzErr);

```

The xCreate method is called to create a new instance of a virtual table 
in response to a [CREATE VIRTUAL TABLE](lang_createvtab.html) statement.
If the xCreate method is the same pointer as the [xConnect](vtab.html#xconnect) method, then the
virtual table is an [eponymous virtual table](vtab.html#epovtab).
If the xCreate method is omitted (if it is a NULL pointer) then the virtual 
table is an [eponymous\-only virtual table](vtab.html#epoonlyvtab).




The db parameter is a pointer to the SQLite [database connection](c3ref/sqlite3.html) that 
is executing the [CREATE VIRTUAL TABLE](lang_createvtab.html) statement. 
The pAux argument is the copy of the client data pointer that was the 
fourth argument to the [sqlite3\_create\_module()](c3ref/create_module.html) or
[sqlite3\_create\_module\_v2()](c3ref/create_module.html) call that registered the 
[virtual table module](c3ref/module.html). 
The argv parameter is an array of argc pointers to null terminated strings. 
The first string, argv\[0], is the name of the module being invoked. The
module name is the name provided as the second argument to 
[sqlite3\_create\_module()](c3ref/create_module.html) and as the argument to the USING clause of the
[CREATE VIRTUAL TABLE](lang_createvtab.html) statement that is running.
The second, argv\[1], is the name of the database in which the new virtual 
table is being created. The database name is "main" for the primary database, or
"temp" for TEMP database, or the name given at the end of the [ATTACH](lang_attach.html)
statement for attached databases. The third element of the array, argv\[2], 
is the name of the new virtual table, as specified following the TABLE
keyword in the [CREATE VIRTUAL TABLE](lang_createvtab.html) statement.
If present, the fourth and subsequent strings in the argv\[] array report 
the arguments to the module name in the [CREATE VIRTUAL TABLE](lang_createvtab.html) statement.



The job of this method is to construct the new virtual table object
(an [sqlite3\_vtab](c3ref/vtab.html) object) and return a pointer to it in \*ppVTab.



As part of the task of creating a new [sqlite3\_vtab](c3ref/vtab.html) structure, this 
method must invoke [sqlite3\_declare\_vtab()](c3ref/declare_vtab.html) to tell the SQLite 
core about the columns and datatypes in the virtual table. 
The [sqlite3\_declare\_vtab()](c3ref/declare_vtab.html) API has the following prototype:




```
int sqlite3_declare_vtab(sqlite3 *db, const char *zCreateTable)

```

The first argument to [sqlite3\_declare\_vtab()](c3ref/declare_vtab.html) must be the same 
[database connection](c3ref/sqlite3.html) pointer as the first parameter to this method.
The second argument to [sqlite3\_declare\_vtab()](c3ref/declare_vtab.html) must a zero\-terminated 
UTF\-8 string that contains a well\-formed [CREATE TABLE](lang_createtable.html) statement that 
defines the columns in the virtual table and their data types. 
The name of the table in this CREATE TABLE statement is ignored, 
as are all constraints. Only the column names and datatypes matter.
The CREATE TABLE statement string need not to be 
held in persistent memory. The string can be
deallocated and/or reused as soon as the [sqlite3\_declare\_vtab()](c3ref/declare_vtab.html)
routine returns.



The xConnect method can also optionally request special features
for the virtual table by making one or more calls to
the [sqlite3\_vtab\_config()](c3ref/vtab_config.html) interface:




```
int sqlite3_vtab_config(sqlite3 *db, int op, ...);

```

Calls to sqlite3\_vtab\_config() are optional. But for maximum
security, it is recommended that virtual table implementations
invoke "[sqlite3\_vtab\_config](c3ref/vtab_config.html)(db, [SQLITE\_VTAB\_DIRECTONLY](c3ref/c_vtab_constraint_support.html#sqlitevtabdirectonly))" if the
virtual table will not be used from inside of triggers or views.



The xCreate method need not initialize the pModule, nRef, and zErrMsg
fields of the [sqlite3\_vtab](c3ref/vtab.html) object. The SQLite core will take care of 
that chore.



The xCreate should return [SQLITE\_OK](rescode.html#ok) if it is successful in 
creating the new virtual table, or [SQLITE\_ERROR](rescode.html#error) if it is not successful.
If not successful, the [sqlite3\_vtab](c3ref/vtab.html) structure must not be allocated. 
An error message may optionally be returned in \*pzErr if unsuccessful.
Space to hold the error message string must be allocated using
an SQLite memory allocation function like 
[sqlite3\_malloc()](c3ref/free.html) or [sqlite3\_mprintf()](c3ref/mprintf.html) as the SQLite core will
attempt to free the space using [sqlite3\_free()](c3ref/free.html) after the error has
been reported up to the application.




If the xCreate method is omitted (left as a NULL pointer) then the
virtual table is an [eponymous\-only virtual table](vtab.html#epoonlyvtab). New instances of
the virtual table cannot be created using [CREATE VIRTUAL TABLE](lang_createvtab.html) and the
virtual table can only be used via its module name.
Note that SQLite versions prior to 3\.9\.0 (2015\-10\-14\) do not understand
eponymous\-only virtual tables and will segfault if an attempt is made
to [CREATE VIRTUAL TABLE](lang_createvtab.html) on an eponymous\-only virtual table because
the xCreate method was not checked for null.




If the xCreate method is the exact same pointer as the [xConnect](vtab.html#xconnect) method,
that indicates that the virtual table does not need to initialize backing
store. Such a virtual table can be used as an [eponymous virtual table](vtab.html#epovtab)
or as a named virtual table using [CREATE VIRTUAL TABLE](lang_createvtab.html) or both.




