### 2\.3\.2\. Outputs


Given all of the information above, the job of the xBestIndex 
method it to figure out the best way to search the virtual table.



The xBestIndex method conveys an indexing strategy to the [xFilter](vtab.html#xfilter) 
method through the idxNum and idxStr fields. The idxNum value and 
idxStr string content are arbitrary as far as the SQLite core is 
concerned and can have any meaning as long as xBestIndex and xFilter 
agree on what that meaning is. The SQLite core just copies the 
information from xBestIndex through to the [xFilter](vtab.html#xfilter) method, assuming 
only that the char sequence referenced via idxStr is NUL terminated.



The idxStr value may be a string obtained from an SQLite
memory allocation function such as [sqlite3\_mprintf()](c3ref/mprintf.html). 
If this is the case, then the needToFreeIdxStr flag must be set to 
true so that the SQLite core will know to call [sqlite3\_free()](c3ref/free.html) on 
that string when it has finished with it, and thus avoid a memory leak.
The idxStr value may also be a static constant string, in which case
the needToFreeIdxStr boolean should remain false.




The estimatedCost field should be set to the estimated number
of disk access operations required to execute this query against 
the virtual table. The SQLite core will often call xBestIndex 
multiple times with different constraints, obtain multiple cost
estimates, then choose the query plan that gives the lowest estimate.
The SQLite core initializes estimatedCost to a very large value
prior to invoking xBestIndex, so if xBestIndex determines that the
current combination of parameters is undesirable, it can leave the
estimatedCost field unchanged to discourage its use.



If the current version of SQLite is 3\.8\.2 or greater, the estimatedRows
field may be set to an estimate of the number of rows returned by the
proposed query plan. If this value is not explicitly set, the default 
estimate of 25 rows is used.



If the current version of SQLite is 3\.9\.0 or greater, the idxFlags field
may be set to SQLITE\_INDEX\_SCAN\_UNIQUE to indicate that the virtual table
will return only zero or one rows given the input constraints. Additional
bits of the idxFlags field might be understood in later versions of SQLite.



The aConstraintUsage\[] array contains one element for each of 
the nConstraint constraints in the inputs section of the 
[sqlite3\_index\_info](c3ref/index_info.html) structure. 
The aConstraintUsage\[] array is used by xBestIndex to tell the 
core how it is using the constraints.



The xBestIndex method may set aConstraintUsage\[].argvIndex 
entries to values greater than zero. 
Exactly one entry should be set to 1, another to 2, another to 3, 
and so forth up to as many or as few as the xBestIndex method wants. 
The EXPR of the corresponding constraints will then be passed 
in as the argv\[] parameters to xFilter.



For example, if the aConstraint\[3].argvIndex is set to 1, then 
when xFilter is called, the argv\[0] passed to xFilter will have 
the EXPR value of the aConstraint\[3] constraint.



