## 2\.21\. The xShadowName Method


Some virtual table implementations (ex: [FTS3](fts3.html), [FTS5](fts5.html), and [RTREE](rtree.html)) make
use of real (non\-virtual) database tables to store content. For example,
when content is inserted into the FTS3 virtual table, the data is ultimately
stored in real tables named "%\_content", "%\_segdir", "%\_segments", "%\_stat",
and "%\_docsize" where "%" is the name of the original virtual table. This
auxiliary real tables that store content for a virtual table are called
"shadow tables". See
([1](fts3.html#*shadowtab)),
([2](fts5.html#fts5shadowtables)), and
([3](rtree.html#xshadow)) for additional information.



The xShadowName method exists to allow SQLite to determine whether a
certain real table is in fact a shadow table for a virtual table.



SQLite understands a real table to be a shadow table if all of
the following are true:





* The name of the table contains one or more "\_" characters.
* The part of the name prior to the last "\_" exactly matches
 the name of a virtual table that was created using [CREATE VIRTUAL TABLE](lang_createvtab.html).
 (Shadow tables are not recognized for [eponymous virtual tables](vtab.html#epovtab)
 and [table\-valued functions](vtab.html#tabfunc2).)
* The virtual table contains an xShadowName method.
* The xShadowName method returns true when its input is the part
 of the table name past the last "\_" character.



If SQLite recognizes a table as a shadow table, and if the
[SQLITE\_DBCONFIG\_DEFENSIVE](c3ref/c_dbconfig_defensive.html#sqlitedbconfigdefensive) flag is set, then the shadow table is read\-only
for ordinary SQL statements. The shadow table can still be written, but
only by SQL that is invoked from within one of the methods of
some virtual table implementation.




The whole point of the xShadowName method is to protect the content of
shadow tables from being corrupted by hostile SQL. Every virtual table
implementation that uses shadow tables should be able to detect and cope
with corrupted shadow table content. However, bugs in particular virtual 
table implementation might allow a deliberately corrupted shadow table to
cause a crash or other malfunction. The xShadowName mechanism seeks to 
avoid zero\-day exploits by preventing ordinary SQL statements from
deliberately corrupting shadow tables.




Shadow tables are read/write by default.
Shadow tables only become read\-only when the [SQLITE\_DBCONFIG\_DEFENSIVE](c3ref/c_dbconfig_defensive.html#sqlitedbconfigdefensive)
flag is set using [sqlite3\_db\_config()](c3ref/db_config.html).
Shadow tables need to be read/write by default in order to maintain
backwards compatibility.
For example, the SQL text generated by the [.dump](cli.html#dump) command of the [CLI](cli.html)
writes directly into shadow tables.




