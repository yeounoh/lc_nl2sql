# 6\. Custom R\-Tree Queries


By using standard SQL expressions in the WHERE clause of a SELECT query,
a programmer can query for all R\*Tree entries that
intersect with or are contained within a particular bounding\-box.
Custom R\*Tree queries, using the MATCH
operator in the WHERE clause of a SELECT, allow the programmer to query for
the set of R\*Tree entries that intersect any arbitrary region or shape, not
just a box. This capability is useful, for example, in computing the
subset of objects in the R\*Tree that are visible from a camera positioned
in 3\-D space.



Regions for custom R\*Tree queries are defined by R\*Tree geometry callbacks
implemented by the application and registered with SQLite via a call to one
of the following two APIs:




```
int sqlite3_rtree_query_callback(
  sqlite3 *db,
  const char *zQueryFunc,
  int (*xQueryFunc)(sqlite3_rtree_query_info*),
  void *pContext,
  void (*xDestructor)(void*)
);
int sqlite3_rtree_geometry_callback(
  sqlite3 *db,
  const char *zGeom,
  int (*xGeom)(sqlite3_rtree_geometry *, int nCoord, double *aCoord, int *pRes),
  void *pContext
);

```

The sqlite3\_rtree\_query\_callback() became available with SQLite
[version 3\.8\.5](releaselog/3_8_5.html) (2014\-06\-04\) and is the preferred interface.
The sqlite3\_rtree\_geometry\_callback() is an older and less flexible
interface that is supported for backwards compatibility.



A call to one of the above APIs creates a new SQL function named by the
second parameter (zQueryFunc or zGeom). When that SQL function appears
on the right\-hand side of the MATCH operator and the left\-hand side of the
MATCH operator is any column in the R\*Tree virtual table, then the callback
defined by the third argument (xQueryFunc or xGeom) is invoked to determine
if a particular object or subtree overlaps the desired region.



For example, a query like the following might be used to find all
R\*Tree entries that overlap with a circle centered a 45\.3,22\.9 with a
radius of 5\.0:




```
SELECT id FROM demo_index WHERE id MATCH circle(45.3, 22.9, 5.0)

```

The SQL syntax for custom queries is the same regardless of which
interface, sqlite3\_rtree\_geometry\_callback() or sqlite3\_rtree\_query\_callback(),
is used to register the SQL function. However, the newer query\-style
callbacks give the application greater control over how the query proceeds.



