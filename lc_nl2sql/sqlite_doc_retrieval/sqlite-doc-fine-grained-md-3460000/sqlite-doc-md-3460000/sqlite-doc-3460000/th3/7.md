# 5\. Mutation Testing


The TH3 source tree contains a scripted name
"mutation\-test.tcl" that automates the process of
[mutation testing](testing.html#mutationtests).



The mutation\-test.tcl script takes care of all of the details for
running a mutation test:



1. The script compiles the TH3 test harness into machine code ("th3\.o") if
 necessary.
2. The script compiles the sqlite3\.c source file into assembly language
 ("sqlite3\.s") if necessary.
3. The script loops through instructions in the assembly language file
 to locate branch operations.
	1. The script makes a copy of the original sqlite3\.s file.
	2. The copy is edited to change the branch instruction into either
	 a no\-op or an unconditional jump.
	3. The copy of sqlite3\.s is assembled into sqlite3\.o then linked
	 again th3\.o to generate the "th3" executable.
	4. The "th3" binary is run and the output checked for errors.
4. The script shows progress for each cycle of the previous step then
 displays a summary of "survivors" at the end. A "survivor" is a
 mutation that was not detected by TH3\.


Mutation testing can be slow, since each test can take up to 5
minutes on a fast workstation, and there are two tests for each
branch instructions, and over 20,000 branch instructions. Efforts are
made to expedite operation. For example, TH3 is compiled in such a
way that it exits as soon as it finds the first error, and as many
of the mutations are easily detected, many cycles happen in only
a few seconds. Nevertheless, the mutation\-test.tcl script includes
command\-line options to limit the range of code lines tested so that
mutation testing only needs to be performed on blocks of code that
have recently changed.



