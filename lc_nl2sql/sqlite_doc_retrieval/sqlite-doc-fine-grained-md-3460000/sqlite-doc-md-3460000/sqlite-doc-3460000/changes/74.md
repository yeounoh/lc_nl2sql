### 2017\-03\-30 (3\.18\.0\)

1. Added the [PRAGMA optimize](pragma.html#pragma_optimize) command
- The SQLite version identifier returned by the [sqlite\_source\_id()](lang_corefunc.html#sqlite_source_id) SQL function
 and the [sqlite3\_sourceid()](c3ref/libversion.html) C API and found in the [SQLITE\_SOURCE\_ID](c3ref/c_source_id.html) macro is
 now a 64\-digit SHA3\-256 hash instead of a 40\-digit SHA1 hash.
- Added the [json\_patch()](json1.html#jpatch) SQL function to the [JSON1 extension](json1.html).
- Enhance the [LIKE optimization](optoverview.html#like_opt) so that it works for arbitrary expressions on
 the left\-hand side as long as the LIKE pattern on the right\-hand side does not
 begin with a digit or minus sign.
- Added the [sqlite3\_set\_last\_insert\_rowid()](c3ref/set_last_insert_rowid.html) interface and use the new interface in
 the [FTS3](fts3.html), [FTS4](fts3.html#fts4), and [FTS5](fts5.html) extensions to ensure that the [sqlite3\_last\_insert\_rowid()](c3ref/last_insert_rowid.html)
 interface always returns reasonable values.
- Enhance [PRAGMA integrity\_check](pragma.html#pragma_integrity_check) and [PRAGMA quick\_check](pragma.html#pragma_quick_check) so that they verify
 [CHECK constraints](lang_createtable.html#ckconst).
- Enhance the query plans for joins to detect empty tables early and
 halt without doing unnecessary work.
- Enhance the [sqlite3\_mprintf()](c3ref/mprintf.html) family of interfaces and the [printf SQL function](lang_corefunc.html#printf)
 to put comma separators at the thousands marks for integers, if the "," format modifier
 is used in between the "%" and the "d" (example: "%,d").
- Added the \-D[SQLITE\_MAX\_MEMORY](compile.html#max_memory)\=*N* compile\-time option.
- Added the [.sha3sum dot\-command](cli.html#sha3sum) and the [.selftest dot\-command](cli.html#selftest)
 to the [command\-line shell](cli.html)- Begin enforcing [SQLITE\_LIMIT\_VDBE\_OP](c3ref/c_limit_attached.html#sqlitelimitvdbeop). This can be used, for example, to prevent
 excessively large prepared statements in systems that accept SQL queries from
 untrusted users.
- Various performance improvements.
**Bug Fixes:**
- Ensure that indexed expressions with collating sequences are handled correctly.
 Fix for ticket [eb703ba7b50c1a5](https://www.sqlite.org/src/info/eb703ba7b50c1a5).
- Fix a bug in the 'start of ...' modifiers for the [date and time functions](lang_datefunc.html).
 Ticket [6097cb92745327a1](https://www.sqlite.org/src/info/6097cb92745327a1)- Fix a potential segfault in complex recursive triggers, resulting from a
 bug in the OP\_Once opcode introduced as part of a performance optimization in
 version 3\.15\.0\.
 Ticket [06796225f59c057c](https://www.sqlite.org/src/info/06796225f59c057c)- In the [RBU extension](rbu.html), add extra sync operations to avoid the possibility of
 corruption following a power failure.
- The [sqlite3\_trace\_v2()](c3ref/trace_v2.html) output for nested SQL statements should always begin
 with a "\-\-" comment marker.
**Hashes:**
- SQLITE\_SOURCE\_ID: "2017\-03\-28 18:48:43 424a0d380332858ee55bdebc4af3789f74e70a2b3ba1cf29d84b9b4bcf3e2e37"
- SHA3\-256 for sqlite3\.c: cbf322df1f76be57fb3be84f3da1fc71d1d3dfdb7e7c2757fb0ff630b3bc2e5d




