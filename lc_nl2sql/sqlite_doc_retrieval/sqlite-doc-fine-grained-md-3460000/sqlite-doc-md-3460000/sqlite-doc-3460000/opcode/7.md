## 2\.5\. Subroutines, Coroutines, and Subprograms


The bytecode engine has no stack on which to store the return address
of a subroutine. Return addresses must be stored in registers.
Hence, bytecode subroutines are not reentrant.


The [Gosub](opcode.html#Gosub) opcode stores the current program counter into
register P1 then jumps to address P2\. The [Return](opcode.html#Return) opcode jumps
to address P1\+1\. Hence, every subroutine is associated with two integers:
the address of the entry point in the subroutine and the register number
that is used to hold the return address.

The [Yield](opcode.html#Yield) opcode swaps the value of the program counter with
the integer value in register P1\. This opcode is used to implement
coroutines. Coroutines are often used to implement subqueries from
which content is pulled on an as\-needed basis.




[Triggers](lang_createtrigger.html) need to be reentrant.


Since bytecode
subroutines are not reentrant a different mechanism must be used to
implement triggers. Each trigger is implemented using a separate bytecode
program with its own opcodes, program counter, and register set. The
[Program](opcode.html#Program) opcode invokes the trigger subprogram. The [Program](opcode.html#Program) instruction
allocates and initializes a fresh register set for each invocation of the
subprogram, so subprograms can be reentrant and recursive. The
[Param](opcode.html#Param) opcode is used by subprograms to access content in registers
of the calling bytecode program.




