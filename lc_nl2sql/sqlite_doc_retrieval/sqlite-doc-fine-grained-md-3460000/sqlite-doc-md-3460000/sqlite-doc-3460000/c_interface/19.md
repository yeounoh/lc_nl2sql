#### 3\.8 Changing the library's response to locked files


The **sqlite\_busy\_handler** procedure can be used to register
a busy callback with an open SQLite database. The busy callback will
be invoked whenever SQLite tries to access a database that is locked.
The callback will typically do some other useful work, or perhaps sleep,
in order to give the lock a chance to clear. If the callback returns
non\-zero, then SQLite tries again to access the database and the cycle
repeats. If the callback returns zero, then SQLite aborts the current
operation and returns SQLITE\_BUSY.


The arguments to **sqlite\_busy\_handler** are the opaque
structure returned from **sqlite\_open**, a pointer to the busy
callback function, and a generic pointer that will be passed as
the first argument to the busy callback. When SQLite invokes the
busy callback, it sends it three arguments: the generic pointer
that was passed in as the third argument to **sqlite\_busy\_handler**,
the name of the database table or index that the library is trying
to access, and the number of times that the library has attempted to
access the database table or index.


For the common case where we want the busy callback to sleep,
the SQLite library provides a convenience routine **sqlite\_busy\_timeout**.
The first argument to **sqlite\_busy\_timeout** is a pointer to
an open SQLite database and the second argument is a number of milliseconds.
After **sqlite\_busy\_timeout** has been executed, the SQLite library
will wait for the lock to clear for at least the number of milliseconds 
specified before it returns SQLITE\_BUSY. Specifying zero milliseconds for
the timeout restores the default behavior.


