### 2\.2\.1\. The RBU Database Schema



For each table in the target database, the RBU database should contain a table
named "data\<*integer*\>\_\<*target\-table\-name*\>" where
\<*target\-table\-name*\> is the name of the table in the target
database and \<*integer*\> is any sequence of zero or more numeric
characters (0\-9\). Tables within the RBU database are processed in order by 
name (from smallest to largest according to the BINARY collation sequence),
so the order in which target tables are updated is influenced by the selection 
of the \<*integer*\> portion of the data\_% table name. While this can
be useful when using RBU to update 
[certain types of virtual tables](rbu.html#fts4_tables), there is normally no
reason to use anything other than an empty string in place of
\<*integer*\>.



The data\_% table must have all the same columns as the target table, plus
one additional column named "rbu\_control". The data\_% table should have no
PRIMARY KEY or UNIQUE constraints, but each column should have the same type as
the corresponding column in the target database. The rbu\_control column should
have no type at all. For example, if the target database contains:




```
CREATE TABLE t1(a INTEGER PRIMARY KEY, b TEXT, c UNIQUE);

```

Then the RBU database should contain:




```
CREATE TABLE data_t1(a INTEGER, b TEXT, c, rbu_control);

```

The order of the columns in the data\_% table does not matter.



If the target database table is a virtual table or a table that has no
PRIMARY KEY declaration, the data\_% table must also contain a column 
named "rbu\_rowid". The rbu\_rowid column is mapped to the tables [ROWID](lang_createtable.html#rowid).
For example, if the target database contains either of the following:




```
CREATE VIRTUAL TABLE x1 USING fts3(a, b);
CREATE TABLE x1(a, b);

```

then the RBU database should contain:




```
CREATE TABLE data_x1(a, b, rbu_rowid, rbu_control);

```

Virtual tables for which the "rowid" column does 
not function like a primary key value cannot be updated using RBU.




All non\-hidden columns (i.e. all columns matched by "SELECT \*") of the
target table must be present in the input table. For virtual tables,
hidden columns are optional \- they are updated by RBU if present in
the input table, or not otherwise. For example, to write to an fts4
table with a hidden languageid column such as:




```
CREATE VIRTUAL TABLE ft1 USING fts4(a, b, languageid='langid');

```

Either of the following input table schemas may be used:




```
CREATE TABLE data_ft1(a, b, langid, rbu_rowid, rbu_control);
CREATE TABLE data_ft1(a, b, rbu_rowid, rbu_control);

```


