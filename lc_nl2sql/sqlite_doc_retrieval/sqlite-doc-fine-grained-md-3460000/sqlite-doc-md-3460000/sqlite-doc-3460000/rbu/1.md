# 1\. The RBU Extension


The RBU extension is an add\-on for SQLite designed for use with large 
SQLite database files on low\-power devices at the edge of a network. RBU
may be used for two separate tasks:



* **RBU Update operations**. An [RBU Update](rbu.html#rbu_updates) is a bulk update of a
 database file that may include many insert, update and delete
 operations on one or more tables.
* **RBU Vacuum operations**. An [RBU Vacuum](rbu.html#rbu_vacuum) optimizes and rebuilds an
 entire database file, with results similar to SQLite's native VACUUM
 command.


The acronym RBU stands for "Resumable Bulk Update".



Both of the RBU functions may be accomplished using SQLite's built\-in 
SQL commands \- RBU update via a series of [INSERT](lang_insert.html), [DELETE](lang_delete.html) and 
[UPDATE](lang_update.html) commands within a single transaction, and RBU vacuum by a single
[VACUUM](lang_vacuum.html) command. The RBU module provides the following advantages over
these simpler approaches:




1. **RBU may be more efficient**
The most efficient way to apply changes to a B\-Tree (the data structure
that SQLite uses to store each table and index on disk) is to make the
changes in key order. But if an SQL table has one or more indexes, the key
order for each index may be different from the main table and the other
auxiliary indexes. As a result, when executing a series of [INSERT](lang_insert.html),
[UPDATE](lang_update.html) and [DELETE](lang_delete.html) statements it is not generally possible to order the
operations so that all b\-trees are updated in key order. The RBU update
process works around this by applying all changes to the main table in one 
pass, then applying changes to each index in separate passes, ensuring each
B\-Tree is updated optimally. For a large database file (one that does not
fit in the OS disk cache) this procedure can result in two orders of
magnitude faster updates.



An RBU Vacuum operation requires less temporary disk space and writes
less data to disk than an SQLite VACUUM. An SQLite VACUUM requires roughly
twice the size of the final database file in temporary disk space to run.
The total amount of data written is around three times the size of the
final database file. By contrast, an RBU Vacuum requires roughly the size
of the final database file in temporary disk space and writes a total of
twice that to disk.



On the other hand, an RBU Vacuum uses more CPU than a regular SQLite
VACUUM \- in one test as much as five times as much. For this reason, an RBU
Vacuum is often significantly slower than an SQLite VACUUM under the same
conditions.
2. **RBU runs in the background**
An ongoing RBU operation (either an update or a vacuum) does not
interfere with read access to the database file.
3. **RBU runs incrementally**
RBU operations may be suspended and then later resumed, perhaps with
intervening power outages and/or system resets. For an RBU update, the
original database content remains visible to all database readers until 
the entire update has been applied \- even if the update is suspended and
then later resumed.


The RBU extension is not enabled by default. To enable it, compile the
[amalgamation](amalgamation.html) with the [SQLITE\_ENABLE\_RBU](compile.html#enable_rbu) compile\-time option.




