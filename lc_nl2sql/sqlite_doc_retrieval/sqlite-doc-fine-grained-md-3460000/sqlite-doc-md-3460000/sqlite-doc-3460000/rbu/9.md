## 2\.3\. RBU Update C/C\+\+ Programming


The RBU extension interface allows an application to apply an RBU update 
stored in an RBU database to an existing target database.
The procedure is as follows:



1. Open an RBU handle using the sqlite3rbu\_open(T,A,S) function.



The T argument is the name of the target database file.
The A argument is the name of the RBU database file.
The S argument is the name of a "state database" used to store
state information needed to resume the update after an interruption.
The S argument can be NULL in which case the state information
is stored in the RBU database in various tables whose names all
begin with "rbu\_".



The sqlite3rbu\_open(T,A,S) function returns a pointer to
an "sqlite3rbu" object, which is then passed into the subsequent
interfaces.
2. Register any required virtual table modules with the database
handle returned by sqlite3rbu\_db(X) (where argument X is the sqlite3rbu
pointer returned from sqlite3rbu\_open()). Also, if required, register
the rbu\_delta() SQL function using 
[sqlite3\_create\_function\_v2()](c3ref/create_function.html).
3. Invoke the sqlite3rbu\_step(X) function one or more times on
the sqlite3rbu object pointer X. Each call to sqlite3rbu\_step() 
performs a single b\-tree operation, so thousands of calls may be 
required to apply a complete update. The sqlite3rbu\_step() 
interface will return SQLITE\_DONE when the update has been
completely applied.
4. Call sqlite3rbu\_close(X) to destroy the sqlite3rbu object pointer.
If sqlite3rbu\_step(X) has been called enough times to completely
apply the update to the target database, then the RBU database
is marked as fully applied. Otherwise, the state of the RBU 
update application is saved in the state database (or in the RBU
database if the name of the state database file in sqlite3rbu\_open()
is NULL) for later resumption of the update.


If an update is only partially applied to the target database by the
time sqlite3rbu\_close() is called, state information is saved 
within the state database if it exists, or otherwise in the RBU database. 
This allows subsequent processes to automatically
resume the RBU update from where it left off.
If state information is stored in the RBU database, it can be removed
by dropping all tables whose names begin with "rbu\_".



For more details, refer to the comments in 
[header file
sqlite3rbu.h](http://sqlite.org/src/doc/trunk/ext/rbu/sqlite3rbu.h).




