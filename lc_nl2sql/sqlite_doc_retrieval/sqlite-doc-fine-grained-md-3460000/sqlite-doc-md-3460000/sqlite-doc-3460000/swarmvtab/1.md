# 1\. Overview


The "swarmvtab" virtual table allows the user to query a large number 
of tables (hereafter "component" tables) with similar schemas but distinct
ranges of rowid values as if they were a single database table. The tables may
be (and usually are) located in different databases. Swarmvtab tables are
read\-only.



Component tables must not be declared WITHOUT ROWID, and must all have
the same schema, but may have different names within their databases. In
this context, "the same schema" means that:



* All component tables must have the same set of columns, in the same 
 order.
* The types and default collation sequences attached to each column
 must be the same for all component tables.
* All component tables must have the same PRIMARY KEY declaration (if any).


A swarmvtab table has the same schema as each of its component tables.



A swarmvtab virtual table is created as follows:




```
CREATE VIRTUAL TABLE temp.<name> USING swarmvtab(<sql-statement>);

```

Swarmvtab virtual tables must be created in the temp schema. Attempting
to create a swarmvtab in the main or an attached database is an error.



The SQL statement supplied as the argument to the CREATE VIRTUAL TABLE
statement is executed when the table is created. It must return either four
or five columns. Each row returned describes one of the component tables. The
first four columns are interpreted, from first to last, as:



* **Database URI**. A filename or URI that can be used to open the
 database containing the component table.
* **Table name**. The name of the component table within its database.
* **Minimum rowid**. The smallest rowid value that the component
 table may contain.
* **Maximum rowid**. The smallest rowid value that the component
 table may contain.


The interpretation of the final column, if it is present, is 
[described here](swarmvtab.html#component_table_context_values).



For example, say the SQL statement returns the following data when 
executed:





| Database URI | Table name | Minimum rowid | Maximum rowid |
| --- | --- | --- | --- |
| test.db1 | t1 | 0 | 10 |
| test.db2 | t2 | 11 | 20 |
| test.db3 | t1 | 21 | 30 |
| test.db4 | t1 | 31 | 40 |


and the user queries the swarmvtab table for the row with rowid value
25\. The swarmvtab table will open database file "test.db3" and read the
data to return from table "t1" (as 25 falls within the range of rowids
assigned to table "t1" in "test.db3").



Swarmvtab efficiently handles range and equality constraints on the
rowid (or other INTEGER PRIMARY KEY) field only. If a query does not 
contain such a constraint, then swarmvtab finds the results by opening
each database in turn and linearly scanning the component table. Which 
generates a correct result, but is often slow.



There must be no overlapping rowid ranges in the rows returned by
the SQL statement. It is an error if there are.



The swarmvtab implementation may open or close databases at any 
point. By default, it attempts to limit the maximum number of 
simultaneously open database files to nine. This is not a hard limit \-
it is possible to construct a scenario that will cause swarmvtab to 
exceed it.




