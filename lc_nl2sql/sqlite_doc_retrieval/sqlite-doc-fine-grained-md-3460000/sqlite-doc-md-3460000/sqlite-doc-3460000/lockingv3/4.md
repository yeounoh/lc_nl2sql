## 4\.0 The Rollback Journal


When a process wants to change a database file (and it is not
in [WAL](wal.html) mode), it
first records the original unchanged database content
in a *rollback journal*. The rollback journal is an ordinary
disk file that is always located
in the same directory or folder as the database file and has the
same name as the database file with the addition of a \-journal
suffix. The rollback journal also records the initial
size of the database so that if the database file grows it can be truncated
back to its original size on a rollback.


If SQLite is working with multiple databases at the same time
(using the [ATTACH](lang_attach.html) command) then each database has its own rollback journal.
But there is also a separate aggregate journal
called the *super\-journal*.
The super\-journal does not contain page data used for rolling back
changes. Instead the super\-journal contains the names of the
individual database rollback journals for each of the ATTACHed databases. 
Each of the individual database rollback journals also contain the name 
of the super\-journal.
If there are no ATTACHed databases (or if none of the ATTACHed database
is participating in the current transaction) no super\-journal is
created and the normal rollback journal contains an empty string
in the place normally reserved for recording the name of the
super\-journal.


A rollback journal is said to be [hot](fileformat2.html#hotjrnl)
if it needs to be rolled back
in order to restore the integrity of its database. 
A hot journal is created when a process is in the middle of a database
update and a program or operating system crash or power failure prevents 
the update from completing.
Hot journals are an exception condition. 
Hot journals exist to recover from crashes and power failures.
If everything is working correctly 
(that is, if there are no crashes or power failures)
you will never get a hot journal.




If no super\-journal is involved, then
a journal is hot if it exists and has a non\-zero header
and its corresponding database file
does not have a RESERVED lock.
If a super\-journal is named in the file journal, then the file journal
is hot if its super\-journal exists and there is no RESERVED
lock on the corresponding database file.
It is important to understand when a journal is hot so the
preceding rules will be repeated in bullets:



* A journal is hot if...
	+ It exists, and
	+ Its size is greater than 512 bytes, and
	+ The journal header is non\-zero and well\-formed, and
	+ Its super\-journal exists or the super\-journal name is an
	 empty string, and
	+ There is no RESERVED lock on the corresponding database file.



