




Atomic Commit In SQLite




[![SQLite](images/sqlite370_banner.gif)](index.html)


Small. Fast. Reliable.  
Choose any three.


* [Home](index.html)* [Menu](javascript:void(0))* [About](about.html)* [Documentation](docs.html)* [Download](download.html)* [License](copyright.html)* [Support](support.html)* [Purchase](prosupport.html)* [Search](javascript:void(0))




* [About](about.html)* [Documentation](docs.html)* [Download](download.html)* [Support](support.html)* [Purchase](prosupport.html)






Search Documentation
Search Changelog










Atomic Commit In SQLite


â–º
Table Of Contents
[1\. Introduction](#_introduction)
[2\. Hardware Assumptions](#_hardware_assumptions)
[3\. Single File Commit](#_single_file_commit)
[3\.1\. Initial State](#_initial_state)
[3\.2\. Acquiring A Read Lock](#_acquiring_a_read_lock)
[3\.3\. Reading Information Out Of The Database](#_reading_information_out_of_the_database)
[3\.4\. Obtaining A Reserved Lock](#_obtaining_a_reserved_lock)
[3\.5\. Creating A Rollback Journal File](#_creating_a_rollback_journal_file)
[3\.6\. Changing Database Pages In User Space](#_changing_database_pages_in_user_space)
[3\.7\. Flushing The Rollback Journal File To Mass Storage](#_flushing_the_rollback_journal_file_to_mass_storage)
[3\.8\. Obtaining An Exclusive Lock](#_obtaining_an_exclusive_lock)
[3\.9\. Writing Changes To The Database File](#_writing_changes_to_the_database_file)
[3\.10\. 0 Flushing Changes To Mass Storage](#0_flushing_changes_to_mass_storage)
[3\.11\. 1 Deleting The Rollback Journal](#1_deleting_the_rollback_journal)
[3\.12\. 2 Releasing The Lock](#2_releasing_the_lock)
[4\. Rollback](#_rollback)
[4\.1\. When Something Goes Wrong...](#_when_something_goes_wrong_)
[4\.2\. Hot Rollback Journals](#_hot_rollback_journals)
[4\.3\. Obtaining An Exclusive Lock On The Database](#_obtaining_an_exclusive_lock_on_the_database)
[4\.4\. Rolling Back Incomplete Changes](#_rolling_back_incomplete_changes)
[4\.5\. Deleting The Hot Journal](#_deleting_the_hot_journal)
[4\.6\. Continue As If The Uncompleted Writes Had Never Happened](#_continue_as_if_the_uncompleted_writes_had_never_happened)
[5\. Multi\-file Commit](#_multi_file_commit)
[5\.1\. Separate Rollback Journals For Each Database](#_separate_rollback_journals_for_each_database)
[5\.2\. The Super\-Journal File](#_the_super_journal_file)
[5\.3\. Updating Rollback Journal Headers](#_updating_rollback_journal_headers)
[5\.4\. Updating The Database Files](#_updating_the_database_files)
[5\.5\. Delete The Super\-Journal File](#_delete_the_super_journal_file)
[5\.6\. Clean Up The Rollback Journals](#_clean_up_the_rollback_journals)
[6\. Additional Details Of The Commit Process](#_additional_details_of_the_commit_process)
[6\.1\. Always Journal Complete Sectors](#_always_journal_complete_sectors)
[6\.2\. Dealing With Garbage Written Into Journal Files](#_dealing_with_garbage_written_into_journal_files)
[6\.3\. Cache Spill Prior To Commit](#_cache_spill_prior_to_commit)
[7\. Optimizations](#_optimizations)
[7\.1\. Cache Retained Between Transactions](#_cache_retained_between_transactions)
[7\.2\. Exclusive Access Mode](#_exclusive_access_mode)
[7\.3\. Do Not Journal Freelist Pages](#_do_not_journal_freelist_pages)
[7\.4\. Single Page Updates And Atomic Sector Writes](#_single_page_updates_and_atomic_sector_writes)
[7\.5\. Filesystems With Safe Append Semantics](#_filesystems_with_safe_append_semantics)
[7\.6\. Persistent Rollback Journals](#_persistent_rollback_journals)
[8\. Testing Atomic Commit Behavior](#_testing_atomic_commit_behavior)
[9\. Things That Can Go Wrong](#_things_that_can_go_wrong)
[9\.1\. Broken Locking Implementations](#_broken_locking_implementations)
[9\.2\. Incomplete Disk Flushes](#_incomplete_disk_flushes)
[9\.3\. Partial File Deletions](#_partial_file_deletions)
[9\.4\. Garbage Written Into Files](#_garbage_written_into_files)
[9\.5\. Deleting Or Renaming A Hot Journal](#_deleting_or_renaming_a_hot_journal)
[10\. Future Directions And Conclusion](#_future_directions_and_conclusion)




